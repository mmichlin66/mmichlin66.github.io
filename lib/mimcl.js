!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("mimbl"),require("mimcss"),require("mimurl")):"function"==typeof define&&define.amd?define(["mimbl","mimcss","mimurl"],e):"object"==typeof exports?exports.mimcl=e(require("mimbl"),require("mimcss"),require("mimurl")):t.mimcl=e(t.mimbl,t.mimcss,t.mimurl)}(this,(function(t,e,s){return(()=>{"use strict";var i={84:(t,e,s)=>{s.r(e),s.d(e,{DNDTYPE_ELEMENT:()=>g,DefaultDialogStyles:()=>l,DefaultPopupStyles:()=>a,Dialog:()=>h,Link:()=>E,MsgBox:()=>u,MsgBoxStyles:()=>c,Popup:()=>n,ProgressBox:()=>m,ProgressBoxStyles:()=>p,Router:()=>f,ScrollAxis:()=>S,ScrollAxisAction:()=>T,VTable:()=>x,createTree:()=>R});var i=s(294),r=s(868),o=function(t,e,s,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,s,i);else for(var n=t.length-1;n>=0;n--)(r=t[n])&&(a=(o<3?r(a):o>3?r(e,s,a):r(e,s))||a);return o>3&&a&&Object.defineProperty(e,s,a),a};class a extends r.StyleDefinition{constructor(){super(...arguments),this.dialog=this.$class({border:[1,"solid","grey"],boxShadow:{x:4,y:4,blur:4,color:"lightgrey"},padding:0,maxWidth:"100%",maxHeight:"100%","::backdrop":{backgroundColor:"grey",opacity:.3}})}}class n extends i.Component{constructor(t,e){super(),this.onKeyDown=t=>{var e;if("Escape"===t.key){t.preventDefault();let s=null===(e=this.options)||void 0===e?void 0:e.escapeReturnValue;void 0!==s&&this.close(s)}},this.onDetectClickOutside=t=>{var e;if(t.target!==this.dlg)return;let s=this.dlg.getBoundingClientRect();(t.clientX<s.left||t.clientX>s.right||t.clientY<s.top||t.clientY>s.bottom)&&this.close(null===(e=this.options)||void 0===e?void 0:e.escapeReturnValue)},this.onPointerMove=t=>{t.preventDefault(),this.dlg&&t.isPrimary?this.move(t.clientX-this.movePointOffsetX,t.clientY-this.movePointOffsetY):this.stopMove()},this.onPointerUp=t=>{t.preventDefault(),this.stopMove()},this._events=i.createMultiEventSlot(),this.content=t,this.options=e}open(){if(this.isOpen)return!1;this._returnValue=void 0,this.create(),this.dlg.show(),this.onOpen(!1)}showModal(){var t;return this.isOpen?Promise.reject(new Error("Popup already open")):(this._returnValue=void 0,this.create(),this.dlg.showModal(),window.addEventListener("keydown",this.onKeyDown),void 0!==(null===(t=this.options)||void 0===t?void 0:t.escapeReturnValue)&&this.dlg.addEventListener("click",this.onDetectClickOutside),this.modalPromise=i.createPromiseEx(),this.modalPromise)}close(t){var e;this.isOpen&&(this.modalPromise&&(void 0!==(null===(e=this.options)||void 0===e?void 0:e.escapeReturnValue)&&this.dlg.removeEventListener("click",this.onDetectClickOutside),window.removeEventListener("keydown",this.onKeyDown),this.modalPromise.resolve(t),this.modalPromise=void 0),this.dlg.close(),this.destroy(),this._returnValue=t,this.onClose(t))}get events(){return this._events}get isOpen(){return null!=this.dlg}isModeless(){return this.isOpen&&!this.modalPromise}isModal(){return this.isOpen&&null!=this.modalPromise}get returnValue(){return this._returnValue}get isVisible(){return this._isVisible}set isVisible(t){this._isVisible=t}setContent(t){this.content=t}startMove(t,e){if(!this.dlg)return;let s=this.dlg.getBoundingClientRect();this.movePointOffsetX=t-s.left,this.movePointOffsetY=e-s.top,this.dlg.style.margin="0",this.dlg.style.top=s.top+"px",this.dlg.style.left=s.left+"px",window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp)}stopMove(){window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this.movePointOffsetX=this.movePointOffsetY=0}moveTo(t,e){this.dlg&&(this.move(t,e),this.dlg.style.margin="0")}willMount(){this.vn.publishService("popup",this)}willUnmount(){this.vn.unpublishService("popup"),r.deactivate(this.defaultStyles),this.defaultStyles=null,this.optionalStyles&&(r.deactivate(this.optionalStyles),this.optionalStyles=null),this.dlg=null,this.anchorElement=null}render(){return this.content}create(){var t,e;this.anchorElement=this.options&&this.options.anchorElement?this.options.anchorElement:document.body,this.defaultStyles=r.activate(this.getDefaultStyles()),this.options&&this.options.styles&&(this.optionalStyles=r.activate(this.options.styles)),this.dlg=document.createElement("dialog"),this.dlg.className=r.chooseClass(null===(t=this.options)||void 0===t?void 0:t.dialogStyleClass,null===(e=this.optionalStyles)||void 0===e?void 0:e.dialog,this.defaultStyles.dialog),this.anchorElement.appendChild(this.dlg);let s={position:"fixed"};this.options&&void 0!==this.options.initialX?s.left=this.options.initialX:s.left=s.right=0,this.options&&void 0!==this.options.initialY?s.top=this.options.initialY:s.top=s.bottom=0,r.setElementStyle(this.dlg,s,1),i.mount(this,this.dlg)}destroy(){i.unmount(this.dlg),this.dlg.remove(),this.dlg=null}move(t,e){t<0?t=0:t+30>window.innerWidth&&(t=window.innerWidth-30),e<0?e=0:e+30>window.innerHeight&&(e=window.innerHeight-30),this.dlg.style.left=t+"px",this.dlg.style.top=e+"px"}getDefaultStyles(){return a}onOpen(t){this._events.open.fire(t)}onClose(t){this._events.close.fire(t)}}o([i.trigger(0)],n.prototype,"content",void 0);class l extends a{constructor(){super(...arguments),this.dialogCaption=this.$class({backgroundColor:"dodgerblue",color:"white",boxShadow:{x:0,y:2,blur:2,color:"lightgrey"},padding:.4}),this.dialogBody=this.$class({padding:.7}),this.dialogButtonBar=this.$class({padding:[.7,1.01],display:"flex",justifyContent:"flex-end",alignItems:"center"}),this.dialogButton=this.$class({padding:.3,marginInlineStart:1.01,minWidth:5.5,border:"none",backgroundColor:15921906,":hover":{backgroundColor:14869218},":focus":{backgroundColor:14869218,outline:[1,"solid",10658466]}})}}class h extends n{constructor(t,e,s,...i){super(t,s),this.buttons=new Map,this.buttonKeys=new Map,this.nextButtonTabIndex=1001,this.captionContent=e;for(let t of i)this.addButton(t)}setCaption(t){this.captionContent=t}addButton(t){let e=new d(t,this.nextButtonTabIndex++);this.buttons.set(t.id,e),t.keycode&&this.buttonKeys.set(t.keycode,e)}get buttonCount(){return this.buttons.size}getDefaultStyles(){return l}willMount(){var t,e,s,i,o,a,n,l,h;super.willMount(),this.captionClassName=r.chooseClass(null===(t=this.options)||void 0===t?void 0:t.dialogCaptionStyleClass,null===(e=this.optionalStyles)||void 0===e?void 0:e.dialogCaption,this.defaultStyles.dialogCaption),this.bodyClassName=r.chooseClass(null===(s=this.options)||void 0===s?void 0:s.dialogBodyStyleClass,null===(i=this.optionalStyles)||void 0===i?void 0:i.dialogBody,this.defaultStyles.dialogBody),this.buttonBarClassName=r.chooseClass(null===(o=this.options)||void 0===o?void 0:o.dialogButtonBarStyleClass,null===(a=this.optionalStyles)||void 0===a?void 0:a.dialogButtonBar,this.defaultStyles.dialogButtonBar),this.buttonClassName=r.chooseClass(null===(n=this.options)||void 0===n?void 0:n.dialogButtonStyleClass,null===(l=this.optionalStyles)||void 0===l?void 0:l.dialogButton,this.defaultStyles.dialogButton),this.vn.publishService("dialog",this),null!=(null===(h=this.options)||void 0===h?void 0:h.defaultButton)&&this.callMeAfterUpdate((()=>{var t;let e=this.buttons.get(null===(t=this.options)||void 0===t?void 0:t.defaultButton);e&&e.ref.focus()}))}willUnmount(){this.vn.unpublishService("dialog"),super.willUnmount()}render(){return i.jsx("div",{keydown:this.onButtonKeyDown},this.renderCaption,this.renderBody,this.renderButtons)}renderCaption(){return i.jsx("div",{class:this.captionClassName,pointerdown:this.onCaptionPointerDown,style:{touchAction:"none"}},this.captionContent)}renderBody(){return i.jsx("div",{class:this.bodyClassName},this.content)}renderButtons(){return i.jsx("div",{class:this.buttonBarClassName},Array.from(this.buttons.values()).map((t=>i.jsx("button",{id:t.btn.id,ref:t.ref,class:this.buttonClassName,click:()=>this.onButtonClicked(t)},t.btn.content))))}onCaptionPointerDown(t){t.isPrimary&&(t.preventDefault(),this.startMove(t.clientX,t.clientY))}onButtonClicked(t){t.btn.callback?t.btn.callback(t.btn.id):this.close(t.btn.returnValue)}onButtonKeyDown(t){let e=this.buttonKeys.get(t.key);e||(e=this.buttonKeys.get(t.code)),e&&(t.preventDefault(),this.onButtonClicked(e))}}o([i.trigger],h.prototype,"captionContent",void 0),o([i.trigger(3)],h.prototype,"buttons",void 0);class d{constructor(t,e){this.btn=t,this.disabled=t.disabled,this.tabIndex=e}}o([i.ref],d.prototype,"ref",void 0);class c extends l{constructor(){super(...arguments),this.container=this.$class({display:"flex",flexDirection:"row",alignItems:"center"}),this.icon=this.$class({padding:r.rem(.5),fontSize:r.em(3),fontWeight:900}),this.text=this.$class({padding:.5,minWidth:r.em(15),maxWidth:r.em(60),minHeight:r.em(2),maxHeight:r.em(20),overflow:"auto",verticalAlign:"middle"})}}class u extends h{constructor(t,e,s=1,i=0,r){super(t,e,{styles:c,escapeReturnValue:0===s?16:void 0,defaultButton:r}),this.icon=i,this.createButtons(s)}static showModal(t,e,s=1,i=0,r){return new u(t,e,s,i,r).showModal()}renderBody(){let{char:t,color:e}=this.getIconClassAndColor();return i.jsx("div",{class:this.optionalStyles.container},t&&i.jsx("span",{class:this.optionalStyles.icon,style:{color:e}},t),i.jsx("span",{class:this.optionalStyles.text},this.content))}getDefaultStyles(){return c}createButtons(t){switch(t){case 16:this.createButton("Close",16);break;case 1:this.createButton("OK",1);break;case 3:this.createButton("OK",1),this.createButton("Cancel",2,"Escape");break;case 12:this.createButton("Yes",4),this.createButton("No",8);break;case 14:this.createButton("Yes",4),this.createButton("No",8),this.createButton("Cancel",2,"Escape")}}getIconClassAndColor(){switch(this.icon){case 1:return{char:"i",color:"blue"};case 4:return{char:"?",color:"green"};case 2:return{char:"!",color:"orange"};case 3:return{char:"x",color:"red"};default:return{}}}createButton(t,e,s){this.addButton({id:e,content:t,returnValue:e,keycode:s})}}class p extends l{constructor(t){super(t),this.container=this.$class({width:r.rem(30),height:r.rem(5),display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-around"}),this.progress=this.$class({width:r.rem(20),height:r.rem(1),margin:r.rem(1)}),this.text=this.$class({textAlign:"center"}),this.dialogButtonBar.setProp("justifyContent","center")}}class m extends h{constructor(t,e,s){super(t,e,{styles:p}),this.delayHandle=0,null!=s&&this.addButton({id:1,content:"Cancel",returnValue:s})}static async showUntil(t,e,s,i=750){let r=new m(e,s);r.showModalWithDelay(i);try{return await t}finally{r.close()}}showModalWithDelay(t){this.delayHandle=setTimeout((()=>this.showNow()),t)}close(t){this.delayHandle>0&&(clearTimeout(this.delayHandle),this.delayHandle=0),super.close(t)}renderBody(){return i.jsx("div",{class:this.optionalStyles.container},i.jsx("progress",{class:this.optionalStyles.progress}),i.jsx("div",{class:this.optionalStyles.text},this.content))}getDefaultStyles(){return p}showNow(){this.delayHandle=0,this.showModal()}}const g="application/DOMElement";var v=s(509);class f extends i.Component{constructor(t){if(super(t),this.onPopstate=t=>{let e=t.state;e&&(e.routeID?this.navigateByID(e.routeID,e.fields):e.routeURL?this.navigateByURL(e.routeURL):console.log("Route state in popstate event has neither route ID nor path."))},this.routes=[],this.routesByID=new Map,this.error=null,this.errorPath=null,this.props.children)for(let t of this.props.children)this.addRoute(t)}addRoute(t,e){if(!t)throw new Error("Route object cannot be null");void 0!==e?this.routes.splice(e,0,t):this.routes.push(t),this.addRouteToMap(t)}removeRoute(t){let e=this.routes.splice(t,1)[0];return this.removeRouteFromMap(e),e}addRouteToMap(t){if(t.id&&this.routesByID.set(t.id,t),t.subRoutes)for(let e of t.subRoutes)this.addRouteToMap(e)}removeRouteFromMap(t){if(t.id&&this.routesByID.delete(t.id),t.subRoutes)for(let e of t.subRoutes)this.removeRouteFromMap(e)}navigateByURL(t,e=!1){let[s,i]=this.findRouteByURL(t);s?this.navigateToRoute(s,t,i,e):this.higherRouterService&&this.higherRouterService.r&&this.higherRouterService.r.navigateByURL(t,e)}navigateByID(t,e,s){let i,r=this.routesByID.get(t);r?(this.controlsBrowser&&(i=r.urlPattern),this.navigateToRoute(r,i,e,s)):this.higherRouterService&&this.higherRouterService.r&&this.higherRouterService.r.navigateByID(t,e)}findRouteByURL(t){return f.findRouteRecursiveByURL(t,this.routes)}static findRouteRecursiveByURL(t,e){for(let s of e){let e=v.match(t,s.urlPattern);if(e&&e.success)return[s,e.fields];if(s.subRoutes){let e=f.findRouteRecursiveByURL(t,s.subRoutes);if(e[0])return e}}return[null,null]}async navigateToRoute(t,e,s,i){if(this.currRoute&&this.currRoute.navFromFunc){let t=this.currRoute.navFromFunc();if(t instanceof Promise&&(t=await t),!t)return}if(this.controlsBrowser&&i){let i={routeID:t.id,routeURL:e,fields:s};history.pushState(i,"",e)}this.currRoute=t;let r=t.navToFunc?t.navToFunc(s):null;this.currRouteContent=r instanceof Promise?await r:r,this.updateMe()}reportError(t){this.handleError(t),this.updateMe()}willMount(){this.vn.publishService("StdErrorHandling",this),this.vn.publishService("Router",this),this.chainsToHigherRouter&&(this.higherRouterService=new i.Ref,this.vn.subscribeService("Router",this.higherRouterService,void 0,!1));let t=this.routes.length>0?this.routes[0]:null;if(!t)return;this.currRoute=t;let e=t.navToFunc?t.navToFunc({}):null;if(e instanceof Promise?(this.currRouteContent="Please wait while content is loading...",e.then((t=>{this.currRouteContent=t,this.updateMe()}))):this.currRouteContent=e,this.controlsBrowser){this.baseURL,window.addEventListener("popstate",this.onPopstate);let e={routeID:t.id,routeURL:t.urlPattern,fields:null};history.replaceState(e,"",t.urlPattern)}}willUnmount(){this.controlsBrowser&&window.removeEventListener("popstate",this.onPopstate),this.chainsToHigherRouter&&(this.vn.unsubscribeService("Router"),this.higherRouterService=void 0),this.vn.unpublishService("Router"),this.vn.unpublishService("StdErrorHandling")}render(){return this.virtRender(this.currRouteContent)}handleError(t){return this.currRouteContent=i.jsx("div",{id:"rootError",style:{backgroundColor:"pink",display:"flex",flexDirection:"column",alignItems:"start"}},t),this.currRouteContent}virtRender(t){return t}get controlsBrowser(){return void 0===this.props.controlsBrowser||this.props.controlsBrowser}get chainsToHigherRouter(){return void 0===this.props.chainsToHigherRouter||this.props.chainsToHigherRouter}get baseURL(){return void 0===this.props.baseURL?"":this.props.baseURL}set OuterContentFunc(t){this.outerContentFunc=t}set ProgressContentFunc(t){this.progressContentFunc=t}}class E extends i.Component{constructor(t){super(t)}render(){let t=this.props,{routeURL:e,routeID:s,fields:r,makeHistoryEntry:o}=t,a=function(t,e){var s={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(s[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(s[i[r]]=t[i[r]])}return s}(t,["routeURL","routeID","fields","makeHistoryEntry"]);return i.jsx("a",Object.assign({href:"#",click:this.onClick},a),this.props.children)}onClick(t){t.preventDefault();let e=this.vn.getService("Router");e&&(this.props.routeID?e.navigateByID(this.props.routeID,this.props.fields,this.props.makeHistoryEntry):e.navigateByURL(this.props.routeURL,this.props.makeHistoryEntry))}}class y extends i.Component{constructor(t){super(),this.nodes=[],this.nodeFactory=t}addNode(t,e){let s=this.nodes.length,i=this.nodeFactory();if(null==e||e<0||e>=s)i.index=s,this.nodes.push(i);else{i.index=e,this.nodes.splice(e,0,i);for(let t=e+1;t<s;t++)this[t].index=t}return i.content=t.content,i.icon=t.icon,i.textColor=t.textColor,i.bgColor=t.bgColor,i.italic=t.italic,i.bold=t.bold,i.customClass=t.customClass,i.data=t.data,this.updateMe(),i}removeNode(t){let e=this.nodes.length;if(t<0||t>=e)throw new Error("replaceNode: invalid index "+t);this.nodes.splice(t,1);for(let s=t;s<e;s++)this[s].index=s;this.updateMe()}removeAllNodes(){let t=this.nodes.length;t>0&&(this.nodes.splice(0,t),this.updateMe())}expandAll(){for(let t of this.nodes)t.expandAll()}collapseAll(){for(let t of this.nodes)t.collapseAll()}render(){return this.nodes}}class w extends i.Component{constructor(t,e,s=null){super(),this.nodeFactory=()=>new w(this,this.m_level+1),this.onClick=t=>{this.select()},this.onDblClick=t=>{t.preventDefault(),t.stopPropagation(),0!==this.subNodes.length&&(this.m_isExpanded?this.collapse():this.expand())},this.onExpanderClicked=t=>{this.m_isExpanded?this.collapse():this.expand()},this.m_parent=t,this.m_tree=null!==t?t.m_tree:s,this.m_level=e,this.container=new y(this.nodeFactory),this.m_isExpanded=!1,this.m_isSelected=!1,this.contentElmRef=new i.Ref}get tree(){return this.m_tree}get parent(){return this.m_parent}get level(){return this.m_level}get index(){return this.m_index}set index(t){this.m_index=t}get content(){return this.m_content}set content(t){this.m_content=t,this.updateMe()}get icon(){return this.m_icon}set icon(t){this.m_icon=t,this.updateMe()}get textColor(){return this.m_textColor}set textColor(t){this.m_textColor=t,this.updateMe()}get bgColor(){return this.m_bgColor}set bgColor(t){this.m_bgColor=t,this.updateMe()}get italic(){return this.m_italic}set italic(t){this.m_italic=t,this.updateMe()}get bold(){return this.m_bold}set bold(t){this.m_bold=t,this.updateMe()}get customClass(){return this.m_customClass}set customClass(t){this.m_customClass=t,this.updateMe()}get data(){return this.m_data}set data(t){this.m_data=t}get isExpanded(){return this.m_isExpanded}expand(){this.container.nodes.length>0&&!0!==this.m_isExpanded&&(this.m_isExpanded=!0,this.updateMe())}collapse(){this.container.nodes.length>0&&!1!==this.m_isExpanded&&(this.m_isExpanded=!1,this.updateMe())}select(){!0!==this.m_isSelected&&(null!=this.m_tree.m_selectedNode&&this.m_tree.m_selectedNode.unselect(),this.m_tree.m_selectedNode=this,this.m_isSelected=!0,this.updateMe())}unselect(){!1!==this.m_isSelected&&(this.m_tree.m_selectedNode=null,this.m_isSelected=!1,this.updateMe())}get subNodes(){return this.container.nodes}addNode(t,e){let s=this.container.addNode(t,e);return 1===this.container.nodes.length&&this.updateMe(),s}removeNode(t){let e=this.container.nodes.length;this.container.removeNode(t),1===e&&0===this.container.nodes.length&&(this.m_isExpanded=!1,this.updateMe())}removeAllNodes(){this.container.nodes.length>0&&(this.container.removeAllNodes(),this.m_isExpanded=!1,this.updateMe())}expandAll(){this.expand(),this.container.expandAll()}collapseAll(){this.collapse(),this.container.collapseAll()}scrollIntoView(t){if(!this.m_tree.elmRef.r||!this.contentElmRef.r)return;let e=this.m_tree.elmRef.r.getBoundingClientRect(),s=this.contentElmRef.r.getBoundingClientRect();s.bottom<=e.bottom&&s.top>=e.top||this.contentElmRef.r.scrollIntoView(t)}render(){return i.jsx(i.Fragment,null,this.renderNode(),this.renderSubNodes())}renderNode(){let t,e=0===this.container.nodes.length?"":this.m_isExpanded?"fa-caret-down":"fa-caret-right";this.m_icon&&("class"in this.m_icon?t=i.jsx("span",{class:this.m_tree.cssClassNodeIcon+" "+this.m_icon.class,click:this.onClick,dblclick:this.onDblClick}):"img"in this.m_icon&&(t=i.jsx("img",{class:this.m_tree.cssClassNodeIcon,src:this.m_icon.img,click:this.onClick,dblclick:this.onDblClick})));let s=this.m_isSelected?this.m_tree.cssClassNodeContentSelected:this.m_tree.cssClassNodeContent;this.m_customClass&&(s+=" "+this.m_customClass);let r={};return this.m_textColor&&(r.color=this.m_textColor),this.m_bgColor&&(r.backgroundColor=this.m_bgColor),this.m_italic&&(r.fontStyle="italic"),this.m_bold&&(r.fontWeight="bold"),i.jsx("div",{class:this.m_tree.cssClassNode},i.jsx("i",{class:"fa fa-fw "+e,click:this.onExpanderClicked}),t,i.jsx("span",{ref:this.contentElmRef,dragSource:!0,class:s,style:r,click:this.onClick,dblclick:this.onDblClick},this.m_content))}renderSubNodes(){return 0===this.subNodes.length?null:i.jsx("div",{class:this.m_tree.cssClassSubnodes,style:{display:this.m_isExpanded?"block":"none"}},this.container)}}class D extends i.Component{constructor(t=null){super(t),this.m_uniqueID=Math.floor(1e9*Math.random()).toString(),this.rules=new Map,this.ruleNames=[],this.styleElm=document.createElement("style"),this.styleElm.id=this.m_uniqueID,document.head.appendChild(this.styleElm)}get uniqueID(){return this.m_uniqueID}decorateName(t){return t+this.m_uniqueID}createStyleRule(t,e,s){let i=this.createDummyRule(t,"dummy {}"),r=i.cssomRule,o=new b(this.uniqueID,r);return e&&o.setSelector(e),s&&o.setProperties(s),i.mcssRule=o,o}getRule(t){let e=this.rules.get(t);return void 0===e?void 0:e.mcssRule}removeRule(t){}willMount(){this.vn.publishService("LocalStyles",this)}willUnmount(){this.vn.unpublishService("LocalStyles"),this.styleElm.remove()}createDummyRule(t,e){let s=this.rules.get(t);void 0!==s&&this.removeRule(t);let i=this.ruleNames.length,r=this.styleElm.sheet;r.insertRule(e,i);let o=r.rules[i];return this.ruleNames.push(t),s={mcssRule:null,cssomRule:o,index:i},this.rules.set(t,s),s}}class b extends class{constructor(t,e){this.uniqueID=t,this.cssomRule=e}decorate(t){return t+this.uniqueID}replace(t){return t.replace("(*)",this.uniqueID)}}{constructor(t,e){super(t,e)}setSelector(t){this.cssomRule.selectorText=this.replace(t)}setProperty(t,e,s){this.cssomRule.style.setProperty(this.replace(t),this.replace(e),s?"important":void 0)}setProperties(t){if(t)for(let e in t){let s=(0,r.getStylePropValue)(e,t[e]);this.cssomRule.style[this.replace(e)]=this.replace(s)}}removeProperty(t){this.cssomRule.style.removeProperty(this.replace(t))}}class C extends D{constructor(){super(),this.onKeyDown=t=>{t.preventDefault(),"ArrowDown"===t.key?this.selectDown(this.m_selectedNode):"ArrowUp"===t.key?this.selectUp(this.m_selectedNode):"ArrowRight"===t.key?this.expandOrSelectDown(this.m_selectedNode):"ArrowLeft"===t.key&&this.collapseOrSelectUp(this.m_selectedNode)},this.m_selectedNode=null,this.tabIndex=0,this.container=new y((()=>new w(null,0,this))),this.elmRef=new i.Ref,this.prepareLocalStyles()}get tabIndex(){return this.m_tabIndex}set tabIndex(t){this.m_tabIndex=t,this.updateMe()}get nodes(){return this.container.nodes}addNode(t,e){let s=this.container.addNode(t,e);return this.updateMe(),s}removeNode(t){this.container.removeNode(t),this.updateMe()}removeAllNodes(){this.container.removeAllNodes(),this.updateMe()}expandAll(){this.container.expandAll()}collapseAll(){this.container.collapseAll()}get selectedNode(){return this.m_selectedNode}render(){return i.jsx("div",{ref:this.elmRef,tabindex:this.tabIndex,class:this.cssClassTree,keydown:this.onKeyDown},this.container)}selectDown(t){let e=this.findDown(t);e&&(e.select(),e.scrollIntoView(!1))}selectUp(t){let e=this.findUp(t);e&&(e.select(),e.scrollIntoView(!0))}expandOrSelectDown(t){if(t)if(t.container.nodes.length>0)if(t.m_isExpanded){let e=t.container.nodes[0];e.select(),e.scrollIntoView(!1)}else t.expand();else this.selectDown(t)}collapseOrSelectUp(t){t&&(t.m_isExpanded?t.collapse():this.selectUp(t))}findDown(t,e=!1){if(t)if(e){let e=t.m_parent?t.m_parent.container:this.container;if(t.index<e.nodes.length-1)return e.nodes[t.index+1];if(t.m_parent)return this.findDown(t.m_parent,!0)}else{if(!(t.isExpanded&&t.container.nodes.length>0))return this.findDown(t,!0);t.container.nodes[0].select()}else if(this.container.nodes.length>0)return this.container.nodes[0];return null}findUp(t){if(t){if(0!==t.index){let e=(t.m_parent?t.m_parent.container:this.container).nodes[t.index-1];return this.findLastExpandedNode(e)||e}if(t.m_parent)return t.m_parent}else if(this.container.nodes.length>0)return this.container.nodes[0];return null}findLastExpandedNode(t){if(!t||0===t.container.nodes.length||!t.m_isExpanded)return null;let e=t.container.nodes[t.container.nodes.length-1];return this.findLastExpandedNode(e)||e}prepareLocalStyles(){this.cssClassTree=this.decorateName("tree"),this.cssRuleTree=this.createStyleRule("tree",".tree(*)",{cursor:"default",border:[1,"solid","dodgerblue"],fontFamily:"Verdana, Geneva, Tahoma, sans-serif",fontSize:12,boxSizing:"border-box",maxHeight:"100%",overflow:"auto"}),this.cssClassNode=this.decorateName("tree-node"),this.cssRuleNode=this.createStyleRule("tree-node",".tree-node(*)",{display:"flex",alignItems:"center"}),this.cssClassNodeContent=this.decorateName("tree-node-content"),this.cssRuleNodeContent=this.createStyleRule("tree-node-content",".tree-node-content(*)",{marginLeft:2,padding:1}),this.cssRuleNodeContentHover=this.createStyleRule("tree-node-content:hover",".tree-node-content(*):hover",{backgroundColor:"lightcyan"}),this.cssClassNodeContentSelected=this.decorateName("tree-node-content-selected"),this.cssRuleNodeContentSelected=this.createStyleRule("tree-node-content-selected",".tree-node-content-selected(*)",{marginLeft:2,border:[1,"dotted"],backgroundColor:"dodgerblue",color:"white"}),this.cssClassNodeIcon=this.decorateName("tree-node-icon"),this.cssRuleNodeIcon=this.createStyleRule("tree-node-icon",".tree-node-icon(*)",{fontSize:10,width:r.em(1),height:r.em(1)}),this.cssClassSubnodes=this.decorateName("tree-subnodes"),this.cssRuleSubNodes=this.createStyleRule("tree-subnodes",".tree-subnodes(*)",{marginLeft:16})}}function R(){return new C}class S{constructor(t,e,s){this.minOverscan=t,this.optOverscan=e,this.maxOverscan=s}measure(t,e,s,i,r,o,a,n){let l=new T;if(0===t)return l;if(0===s)throw new Error("itemCount cannot be zero");let h=e+s-1,d=t-1,c=a/s;i&&(c=(c+i)/2);let u=Math.min(Math.floor(n/c),d),p=Math.min(Math.ceil((n+r)/c),d),m=Math.max(u-this.minOverscan,0),g=Math.max(u-this.optOverscan,0),v=Math.max(u-this.maxOverscan,0),f=Math.min(p+this.minOverscan,d),E=Math.min(p+this.optOverscan,d),y=Math.min(p+this.maxOverscan,d),w=e>m||e<v?g:e,D=h<f||h>y?E:h;return w>D&&console.error(`Wrong ScrollAxis calculation: newFirst '${w}' is greater than newLast '${D}'`),l.newFirst=w,l.newLast=D,l.newAvgItemSize=c,l.newWallSize=Math.ceil(t*c),l.newSubsetOffset=Math.ceil(w*c),w==e&&D==h?l.noAddRemoveNeeded=!0:w>h||D<e?l.neeedToRemoveAllItems=!0:(w<e?l.countToAddAtStart=e-w:w>e&&(l.countToRemoveAtStart=w-e),D<h?l.countToRemoveAtEnd=h-D:D>h&&(l.countToAddAtEnd=D-h)),l}}class T{constructor(){this.newAvgItemSize=0,this.newWallSize=0,this.newSubsetOffset=0,this.newFirst=0,this.newLast=0,this.noAddRemoveNeeded=!1,this.neeedToRemoveAllItems=!1,this.countToRemoveAtStart=0,this.countToRemoveAtEnd=0,this.countToAddAtStart=0,this.countToAddAtEnd=0}}class x extends D{constructor(t){super(t),this.frameRef=t=>this.frame=t,this.wallRef=t=>this.wall=t,this.tableRef=t=>this.table=t,this.avgRowHeight=0,this.avgColWidth=0,this.latestScrollTop=-1,this.latestScrollLeft=-1,this.wallHeight=25*this.props.totalRowCount,this.wallWidth=80*this.props.totalColCount,this.minRowOverscan=this.props.rowOverscan?this.props.rowOverscan[0]:3,this.optRowOverscan=this.props.rowOverscan?this.props.rowOverscan[1]:6,this.maxRowOverscan=this.props.rowOverscan?this.props.rowOverscan[2]:12,this.minColOverscan=this.props.colOverscan?this.props.colOverscan[0]:3,this.optColOverscan=this.props.colOverscan?this.props.colOverscan[1]:6,this.maxColOverscan=this.props.colOverscan?this.props.colOverscan[2]:12,this.prepareLocalStyles()}willMount(){this.rows=[];let t=this.props.totalRowCount<10?this.props.totalRowCount:10,e=this.props.totalColCount<10?this.props.totalColCount:10;for(let s=0;s<t;s++){let t=new M;for(let i=0;i<e;i++)t.addCell(this.getCellData(s,i));this.rows.push(t)}this.firstRow=0,this.lastRow=t-1,this.firstCol=0,this.lastCol=e-1,this.vAxis=new S(this.minRowOverscan,this.optRowOverscan,this.maxRowOverscan),this.hAxis=new S(this.minColOverscan,this.optColOverscan,this.maxColOverscan)}prepareLocalStyles(){this.frameID=this.decorateName("frame"),this.createStyleRule("frame","#frame(*)",{width:"100%",height:"100%",overflow:"auto"}),this.wallID=this.decorateName("wall"),this.createStyleRule("wall","#wall(*)",{position:"relative",overflow:"hidden"}),this.tableID=this.decorateName("table"),this.createStyleRule("table","#table(*)",{position:"absolute",borderCollapse:"collapse",border:[1,"solid","black"]})}render(){return this.callMeBeforeUpdate(this.measureAndUpdate),i.jsx("div",{id:this.frameID,ref:this.frameRef,scroll:this.onScroll},i.jsx("div",{id:this.wallID,ref:this.wallRef},i.jsx("table",{id:this.tableID,ref:this.tableRef},i.jsx("tbody",null,this.renderRows))))}renderRows(){return this.rows}getCellData(t,e){return this.props.getCellCallback?this.props.getCellCallback(t,e):void 0}getColHeaderCellData(t,e){return this.props.getColHeaderCellCallback?this.props.getColHeaderCellCallback(t,e):void 0}getColFooterCellData(t,e){return this.props.getColFooterCellCallback?this.props.getColFooterCellCallback(t,e):void 0}getRowHeaderCellData(t,e){return this.props.getRowHeaderCellCallback?this.props.getRowHeaderCellCallback(t,e):void 0}getRowFooterCellData(t,e){return this.props.getRowFooterCellCallback?this.props.getRowFooterCellCallback(t,e):void 0}measureAndUpdate(){if(0===this.rowCount||0===this.colCount)return;let t=this.frame.getBoundingClientRect(),e=this.wall.getBoundingClientRect(),s=this.table.getBoundingClientRect();if(this.latestScrollTop!=this.frame.scrollTop){let i=this.vAxis.measure(this.props.totalRowCount,this.firstRow,this.rowCount,this.avgRowHeight,t.height,e.height,s.height,this.frame.scrollTop);this.avgRowHeight=i.newAvgItemSize,this.latestScrollTop=this.frame.scrollTop,i.noAddRemoveNeeded||this.updateRows(i),i.newWallSize==e.height&&i.newSubsetOffset==s.top-e.top||this.callMeAfterUpdate((()=>{this.table.style.top=i.newSubsetOffset+"px",this.wall.style.height=i.newWallSize+"px"}))}if(this.latestScrollLeft!=this.frame.scrollLeft){let i=this.hAxis.measure(this.props.totalColCount,this.firstCol,this.colCount,this.avgColWidth,t.width,e.width,s.width,this.frame.scrollLeft);this.avgColWidth=i.newAvgItemSize,this.latestScrollLeft=this.frame.scrollLeft,i.noAddRemoveNeeded||this.updateCols(i),i.newWallSize==e.width&&i.newSubsetOffset==s.left-e.left||this.callMeAfterUpdate((()=>{this.table.style.left=i.newSubsetOffset+"px",this.wall.style.width=i.newWallSize+"px"}))}}updateRows(t){if(t.neeedToRemoveAllItems){this.rows=[];for(let e=t.newFirst;e<=t.newLast;e++){let t=new M;for(let s=this.firstCol;s<=this.lastCol;s++)t.addCell(this.getCellData(e,s));this.rows.push(t)}}else{if(t.countToRemoveAtEnd>0&&this.rows.splice(this.rowCount-t.countToRemoveAtEnd,t.countToRemoveAtEnd),t.countToRemoveAtStart>0&&this.rows.splice(0,t.countToRemoveAtStart),t.countToAddAtEnd>0)for(let e=this.lastRow+1;e<=t.newLast;e++){let t=new M;for(let s=this.firstCol;s<=this.lastCol;s++)t.addCell(this.getCellData(e,s));this.rows.push(t)}if(t.countToAddAtStart>0)for(let e=this.firstRow-1;e>=t.newFirst;e--){let t=new M;for(let s=this.firstCol;s<=this.lastCol;s++)t.addCell(this.getCellData(e,s));this.rows.splice(0,0,t)}}this.firstRow=t.newFirst,this.lastRow=t.newLast,this.updateMe(this.renderRows)}updateCols(t){if(t.neeedToRemoveAllItems)for(let e=this.firstRow;e<=this.lastRow;e++){let s=this.rows[e-this.firstRow];s.removeAllCells();for(let i=t.newFirst;i<=t.newLast;i++)s.addCell(this.getCellData(e,i))}else{if(t.countToRemoveAtEnd>0)for(let e of this.rows)e.removeCellsAtEnd(t.countToRemoveAtEnd);if(t.countToRemoveAtStart>0)for(let e of this.rows)e.removeCellsAtStart(t.countToRemoveAtStart);if(t.countToAddAtEnd>0)for(let e=this.firstRow;e<=this.lastRow;e++){let s=this.rows[e-this.firstRow];for(let i=this.lastCol+1;i<=t.newLast;i++)s.addCell(this.getCellData(e,i))}if(t.countToAddAtStart>0)for(let e=this.firstRow;e<=this.lastRow;e++){let s=this.rows[e-this.firstRow];for(let i=this.firstCol-1;i>=t.newFirst;i--)s.insertCell(this.getCellData(e,i))}}this.firstCol=t.newFirst,this.lastCol=t.newLast}onScroll(t){this.callMeBeforeUpdate(this.measureAndUpdate)}get rowCount(){return this.lastRow-this.firstRow+1}get colCount(){return this.lastCol-this.firstCol+1}get Rows(){return`${this.firstRow} - ${this.lastRow}`}get Cols(){return`${this.firstCol} - ${this.lastCol}`}}class M extends i.Component{constructor(){super(),this.cells=[]}addCell(t){this.cells.push(new _(t)),this.updateMe()}insertCell(t){this.cells.splice(0,0,new _(t)),this.updateMe()}removeAllCells(){this.cells=[],this.updateMe()}removeCellsAtStart(t){this.cells.splice(0,t),this.updateMe()}removeCellsAtEnd(t){this.cells.splice(this.cells.length-t,t),this.updateMe()}render(){return i.jsx("tr",null,this.cells)}}class _ extends i.Component{constructor(t){super(),void 0===t?this.data=void 0:"object"==typeof t&&t.content?this.data=t:this.data={content:t}}render(){return void 0===this.data?void 0:i.jsx("td",{class:this.data.class,style:this.data.style,rowspan:this.data.rowSpan?this.data.rowSpan:void 0,colspan:this.data.colSpan?this.data.colSpan:void 0},this.data.content)}}class O{static setObjectData(t,e){t&&void 0!==e&&O.dataMap.set(t,e)}static getObjectData(t){return O.dataMap.get(t)}static removeObjectData(t){O.dataMap.delete(t)}static clearAllObjectData(){O.dataMap.clear()}static hasType(t,e){return t.types.indexOf?t.types.indexOf(e)>=0:t.types.contains(e)}}O.dataMap=new Map;class A extends DataTransfer{constructor(){super(),this.isImageElmReset=!1,this.dataMap=new Map,this.dataFormats=[]}setDragImage(t,e,s){this.imageElm=t,this.imageElmX=e,this.imageElmY=s,super.setDragImage&&super.setDragImage(t,e,s),this.isImageElmReset=!0}set effectAllowed(t){this.effectAllowedEx=t,super.effectAllowed=t}get effectAllowed(){return void 0===this.effectAllowedEx?super.effectAllowed:this.effectAllowedEx}set dropEffect(t){this.dropEffectEx=t,super.dropEffect=t}get dropEffect(){return void 0===this.dropEffectEx?super.dropEffect:this.dropEffectEx}setData(t,e){return super.setData(t,e),this.dataMap.set(t,e),this.dataFormats=Array.from(this.dataMap.keys()),!0}getData(t){let e=this.dataMap.get(t);return void 0===e?"":e}clearData(t){return super.clearData(t),t?this.dataMap.delete(t):this.dataMap.clear(),this.dataFormats=Array.from(this.dataMap.keys()),!0}get types(){return this.dataFormats}}class L extends DataTransfer{constructor(){super(),this.isImageElmReset=!1,this.dataMap=new Map,this.dataFormats=[],this.m_items=null,this.m_files=null}setDragImage(t,e,s){this.imageElm=t,this.imageElmX=e,this.imageElmY=s,this.isImageElmReset=!0}set effectAllowed(t){this.effectAllowedEx=t}get effectAllowed(){return this.effectAllowedEx}set dropEffect(t){this.dropEffectEx=t}get dropEffect(){return this.dropEffectEx}setData(t,e){return this.dataMap.set(t,e),this.dataFormats=Array.from(this.dataMap.keys()),!0}getData(t){let e=this.dataMap.get(t);return void 0===e?"":e}clearData(t){return t?this.dataMap.delete(t):this.dataMap.clear(),this.dataFormats=Array.from(this.dataMap.keys()),!0}get types(){return this.dataFormats}get files(){return this.m_files}get items(){return this.m_items}}class k{get dragEvent(){return this.m_dragEvent}set dragEvent(t){this.m_dragEvent=t}setData(t,e){"string"==typeof e?this.m_dragEvent.dataTransfer.setData(t,e):(this.m_dragEvent.dataTransfer.setData(t,""),O.setObjectData(t,e))}}class N{constructor(t,e){this.onDragStart=t=>{if(O.clearAllObjectData(),this.dragSourceEvent.dragEvent=t,2===this.behavior){for(let t in this.simpleDragSource.data)this.dragSourceEvent.setData(t,this.simpleDragSource.data[t]);void 0!==this.simpleDragSource.allowedEffects?t.dataTransfer.effectAllowed=this.simpleDragSource.allowedEffects:t.dataTransfer.effectAllowed="all"}else if(1===this.behavior)try{this.dragSource.onDragStart&&this.dragSource.onDragStart(this.dragSourceEvent)}catch(t){throw O.clearAllObjectData(),t}else this.dragSourceEvent.setData(g,this.elm),t.dataTransfer.effectAllowed="all",3===this.behavior?this.dragSourceEvent.setData("text/plain",this.elm.textContent):4===this.behavior&&this.dragSourceEvent.setData("text/plain",this.elm.outerHTML)},this.onDragEnd=t=>{if(1===this.behavior)try{this.dragSource.onDragEnd&&(this.dragSourceEvent.dragEvent=t,this.dragSource.onDragEnd(this.dragSourceEvent))}finally{O.clearAllObjectData()}else O.clearAllObjectData()},this.onDrag=t=>{1===this.behavior&&this.dragSource.onDrag&&(this.dragSourceEvent.dragEvent=t,this.dragSource.onDrag(this.dragSourceEvent))},this.elm=t,"elm-text"===e?this.behavior=3:"elm-html"===e||!0===e?this.behavior=4:void 0!==e.data?(this.behavior=2,this.simpleDragSource=e):void 0!==e.onDragStart&&(this.behavior=1,this.dragSource=e)}init(){this.dragSourceEvent=new k,this.elm.setAttribute("draggable","true"),this.elm.addEventListener("dragstart",this.onDragStart),this.elm.addEventListener("dragend",this.onDragEnd),this.elm.addEventListener("drag",this.onDrag)}term(){this.elm.removeEventListener("dragstart",this.onDragStart),this.elm.removeEventListener("dragend",this.onDragEnd),this.elm.removeEventListener("drag",this.onDrag),this.elm.removeAttribute("draggable"),this.dragSourceEvent=void 0}}class B extends N{constructor(t,e){super(t,e),this.onMouseDown=t=>{0===t.button&&(t.preventDefault(),this.mouseDownX=t.clientX,this.mouseDownY=t.clientY,document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp))},this.onMouseMove=t=>{if(0!=(1&t.buttons))if(t.preventDefault(),void 0!==this.emulDataTransfer)this.handleDragStep(t);else{let e=t.clientX-this.mouseDownX,s=t.clientY-this.mouseDownY;if(e>=-2&&e<=2&&s>=-2&&s<=2)return;this.initiateDragOperation(t)}},this.onMouseUp=t=>{void 0!==this.emulDataTransfer&&this.handleDrop(t),this.cleanupDragOperation()},this.onKeyDown=t=>{t.preventDefault(),t.stopPropagation(),27===t.keyCode?(void 0!==this.emulDataTransfer&&this.cancelDragOperation(t),this.cleanupDragOperation()):void 0!==this.emulDataTransfer&&this.handleKeyEvent(t)},this.onKeyUp=t=>{t.preventDefault(),t.stopPropagation(),void 0!==this.emulDataTransfer&&this.handleKeyEvent(t)}}init(){super.init(),this.elm.addEventListener("mousedown",this.onMouseDown)}term(){super.term(),this.elm.removeEventListener("mousedown",this.onMouseDown)}initiateDragOperation(t){"setDragImage"in DataTransfer.prototype?this.emulDataTransfer=new A:this.emulDataTransfer=new L;let e=this.createDragEventFromMouseEvent(t,"dragstart");if(this.elm.dispatchEvent(e),e.defaultPrevented)this.cleanupDragOperation();else{if(!this.emulDataTransfer.isImageElmReset){let e=this.elm.getBoundingClientRect();this.emulDataTransfer.setDragImage(this.elm,t.clientX-e.left,t.clientY-e.top)}this.lastTarget=void 0,this.isLastTargetDroppable=!1,this.isDropPossibleOnLastTarget=!1,this.handleDragStep(t)}}handleDragStep(t){this.emulDataTransfer.isImageElmReset&&(this.prepareImageElement(),this.emulDataTransfer.isImageElmReset=!1),this.emulDataTransfer.dropEffect="none";let e=null,s=document.elementsFromPoint(t.clientX,t.clientY);if(null!==s){let t=!1;for(let i of s){if(t){e=i;break}i===this.imageElm&&(t=!0)}}if(e)if(e===this.lastTarget){if(this.isLastTargetDroppable){let s=this.createDragEventFromMouseEvent(t,"dragover");e.dispatchEvent(s),this.isDropPossibleOnLastTarget=s.defaultPrevented}}else{let s=this.createDragEventFromMouseEvent(t,"dragenter");e.dispatchEvent(s);let i=s.defaultPrevented;if(this.lastTarget&&this.isLastTargetDroppable&&this.lastTarget.dispatchEvent(this.createDragEventFromMouseEvent(t,"dragleave")),this.lastTarget=e,this.isLastTargetDroppable=i,this.isDropPossibleOnLastTarget=i,this.isLastTargetDroppable){let s=this.createDragEventFromMouseEvent(t,"dragover");e.dispatchEvent(s),this.isDropPossibleOnLastTarget=s.defaultPrevented}}else this.lastTarget&&(this.isLastTargetDroppable&&this.lastTarget.dispatchEvent(this.createDragEventFromMouseEvent(t,"dragleave")),this.lastTarget=void 0,this.isLastTargetDroppable=!1,this.isDropPossibleOnLastTarget=!1);if(this.elm.dispatchEvent(this.createDragEventFromMouseEvent(t,"drag")),this.imageElm&&(this.imageElm.style.left=t.clientX-this.emulDataTransfer.imageElmX+"px",this.imageElm.style.top=t.clientY-this.emulDataTransfer.imageElmY+"px"),this.dropEffectElm){let t=this.isDropPossibleOnLastTarget?this.emulDataTransfer.dropEffect:"none";this.setDropEffectImageCue(t),this.dropEffectElm.style.left=this.emulDataTransfer.imageElmX+12+"px",this.dropEffectElm.style.top=this.emulDataTransfer.imageElmY+0+"px"}this.lastMouseEvent=t}handleKeyEvent(t){if(this.lastTarget&&this.isLastTargetDroppable){let e=this.createDragEventFromKeyboardEvent(t,"dragover");if(this.lastTarget.dispatchEvent(e),this.isDropPossibleOnLastTarget=e.defaultPrevented,this.elm.dispatchEvent(this.createDragEventFromKeyboardEvent(t,"drag")),this.dropEffectElm){let t=this.isDropPossibleOnLastTarget?this.emulDataTransfer.dropEffect:"none";this.setDropEffectImageCue(t)}}}prepareImageElement(){this.imageElm&&(this.imageElm.remove(),this.imageElm);let t=this.emulDataTransfer.imageElm;if(!t)return;let e=document.createElement("div"),s=t.cloneNode();if(i.isSvg(t)&&!i.isSvgSvg(t)){let t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.appendChild(s),e.appendChild(t)}else e.appendChild(s);e.style.opacity="0.7",e.style.position="absolute",this.dropEffectElm=document.createElement("span"),this.dropEffectElm.style.position="absolute",e.appendChild(this.dropEffectElm),document.body.appendChild(e),this.imageElm=e;let r=s.getBoundingClientRect(),o=e.getBoundingClientRect();r.left!=o.left&&(this.emulDataTransfer.imageElmX+=r.left-o.left),r.top!=o.top&&(this.emulDataTransfer.imageElmY+=r.top-o.top)}setDropEffectImageCue(t){let e,s;switch(t){case"none":e="fa fa-fw fa-ban",s="red";break;case"copy":e="fa fa-fw fa-plus",s="green";break;case"link":e="fa fa-fw fa-link",s="blue";break;default:e="",s="black"}this.dropEffectElm.className=e,this.dropEffectElm.style.color=s}handleDrop(t){this.lastTarget?this.isDropPossibleOnLastTarget?this.lastTarget.dispatchEvent(this.createDragEventFromMouseEvent(t,"drop")):this.isLastTargetDroppable?this.lastTarget.dispatchEvent(this.createDragEventFromMouseEvent(t,"dragleave")):this.emulDataTransfer.dropEffect="none":this.emulDataTransfer.dropEffect="none",this.elm.dispatchEvent(this.createDragEventFromMouseEvent(t,"dragend"))}cancelDragOperation(t){this.emulDataTransfer.dropEffect="none",this.lastTarget&&this.isLastTargetDroppable&&this.lastTarget.dispatchEvent(this.createDragEventFromKeyboardEvent(t,"dragleave")),this.elm.dispatchEvent(this.createDragEventFromKeyboardEvent(t,"dragend"))}cleanupDragOperation(){this.emulDataTransfer=void 0,document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),this.lastTarget=void 0,this.isLastTargetDroppable=!1,this.isDropPossibleOnLastTarget=!1,this.lastMouseEvent=void 0,this.imageElm&&(this.imageElm.remove(),this.imageElm=void 0)}createDragEventFromMouseEvent(t,e){if("initDragEvent"in DragEvent.prototype){let s=document.createEvent("DragEvent");return s.initDragEvent(e,t.bubbles,t.cancelable,t.view,t.detail,t.screenX,t.screenY,t.clientX,t.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,t.button,t.relatedTarget,this.emulDataTransfer),s}return new DragEvent(e,{bubbles:t.bubbles,cancelable:t.cancelable,detail:t.detail,view:t.view,altKey:t.altKey,button:t.button,buttons:t.buttons,clientX:t.clientX,clientY:t.clientY,ctrlKey:t.ctrlKey,metaKey:t.metaKey,relatedTarget:t.relatedTarget,screenX:t.screenX,screenY:t.screenY,shiftKey:t.shiftKey,dataTransfer:this.emulDataTransfer})}createDragEventFromKeyboardEvent(t,e){if("initDragEvent"in DragEvent.prototype){let s=document.createEvent("DragEvent");return s.initDragEvent(e,t.bubbles,t.cancelable,t.view,t.detail,this.lastMouseEvent.screenX,this.lastMouseEvent.screenY,this.lastMouseEvent.clientX,this.lastMouseEvent.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,this.lastMouseEvent.button,this.lastMouseEvent.relatedTarget,this.emulDataTransfer),s}return new DragEvent(e,{bubbles:t.bubbles,cancelable:t.cancelable,detail:t.detail,view:t.view,altKey:t.altKey,button:this.lastMouseEvent.button,buttons:this.lastMouseEvent.buttons,clientX:this.lastMouseEvent.clientX,clientY:this.lastMouseEvent.clientY,ctrlKey:t.ctrlKey,metaKey:t.metaKey,relatedTarget:this.lastMouseEvent.relatedTarget,screenX:this.lastMouseEvent.screenX,screenY:this.lastMouseEvent.screenY,shiftKey:t.shiftKey,dataTransfer:this.emulDataTransfer})}}class P{get dragEvent(){return this.m_dragEvent}set dragEvent(t){this.m_dragEvent=t}hasType(t){return O.hasType(this.dragEvent.dataTransfer,t)}getData(t){let e=O.getObjectData(t);return void 0!==e?e:this.m_dragEvent.dataTransfer.getData(t)}hasFiles(){let t=this.m_dragEvent.dataTransfer.files;return t&&t.length>0}getFiles(){let t=this.m_dragEvent.dataTransfer.items;if(!t||0===t.length)return;let e=[];if(t)for(let s=0;s<t.length;s++)e.push(t[s].webkitGetAsEntry());return e}}class I{constructor(t,e){this.onDragEnter=t=>{if(t.stopPropagation(),this.dragTargetEnterCounter++>0)this.isDropPossible&&t.preventDefault();else{if(this.isDropPossible=!1,this.simpleDragTarget){for(let e of this.simpleDragTarget.dataTypes)if(O.hasType(t.dataTransfer,e)){this.isDropPossible=!0;break}if(!this.isDropPossible)return}else this.dragTarget&&(void 0===this.dragTarget.onDragEnter?this.isDropPossible=!0:(this.dragTargetEvent.dragEvent=t,this.isDropPossible=this.dragTarget.onDragEnter(this.dragTargetEvent)));if(this.isDropPossible)if(t.preventDefault(),this.simpleDragTarget){if(this.simpleDragTarget.feedback){let t=this.elm.style;this.savedStyle={};for(let e in this.simpleDragTarget.feedback)this.savedStyle[e]=t[e],t[e]=this.simpleDragTarget.feedback[e]}}else this.dragTarget&&(this.dragTarget.onDragEnter||(t.dataTransfer.dropEffect=this.getDefaultDropEffect(t)))}},this.onDragOver=t=>{t.stopPropagation();let e=!1;this.simpleDragTarget?e=!0:this.dragTarget&&(this.dragTarget.onDragOver?(this.dragTargetEvent.dragEvent=t,e=this.dragTarget.onDragOver(this.dragTargetEvent)):e=!0),e&&(t.preventDefault(),this.simpleDragTarget?t.dataTransfer.dropEffect=this.getDefaultDropEffect(t):this.dragTarget&&(this.dragTarget.onDragOver||(t.dataTransfer.dropEffect=this.getDefaultDropEffect(t))))},this.onDragLeave=t=>{if(t.preventDefault(),t.stopPropagation(),!(--this.dragTargetEnterCounter>0))if(this.simpleDragTarget){if(this.savedStyle){let t=this.elm.style;for(let e in this.savedStyle)t[e]=this.savedStyle[e];this.savedStyle=void 0}}else this.dragTarget&&this.dragTarget.onDragLeave&&(this.dragTargetEvent.dragEvent=t,this.dragTarget.onDragLeave(this.dragTargetEvent))},this.onDrop=t=>{if(t.preventDefault(),t.stopPropagation(),this.simpleDragTarget){let e=this.simpleDragTarget.dataTypes,s={};for(let i of t.dataTransfer.types){if(e&&e.length>0&&e.indexOf(i)<0)continue;let r=O.getObjectData(i);void 0!==r?s[i]=r:(r=t.dataTransfer.getData(i),void 0!==r&&(s[i]=r))}this.simpleDragTarget.onDataDropped(s)}else this.dragTarget&&(this.dragTargetEvent.dragEvent=t,this.dragTarget.onDrop(this.dragTargetEvent));this.dragTargetEnterCounter=0},this.elm=t,void 0!==e.onDrop?this.dragTarget=e:void 0!==e.onDataDropped&&(this.simpleDragTarget=e)}init(){this.dragTargetEvent=new P,this.dragTargetEnterCounter=0,this.elm.addEventListener("dragenter",this.onDragEnter),this.elm.addEventListener("dragleave",this.onDragLeave),this.elm.addEventListener("dragover",this.onDragOver),this.elm.addEventListener("drop",this.onDrop)}term(){this.elm.removeEventListener("dragenter",this.onDragEnter),this.elm.removeEventListener("dragleave",this.onDragLeave),this.elm.removeEventListener("dragover",this.onDragOver),this.elm.removeEventListener("drop",this.onDrop),this.dragTargetEvent=void 0}getDefaultDropEffect(t){switch(t.dataTransfer.effectAllowed){case"copy":return"copy";case"move":return"move";case"link":return"link";case"copyMove":return t.ctrlKey?"copy":"move";case"copyLink":return t.altKey?"link":"copy";case"linkMove":return t.altKey?"link":"move";case"all":return t.altKey?"link":t.ctrlKey?"copy":"move"}}isDropEffectAllowed(t,e){switch(e){case"copy":return"copy"===t;case"move":return"move"===t;case"link":return"link"===t;case"copyMove":return"copy"===t||"move"===t;case"copyLink":return"copy"===t||"link"===t;case"linkMove":return"link"===t||"move"===t;case"none":return"none"!==t;default:return!1}}}i.registerCustomAttribute("dragSource",class{constructor(t,e){this.elmVN=t,this.currVal=e,this.add(e)}terminate(t){this.remove(),this.elmVN=void 0}update(t){return this.currVal!==t&&(this.currVal&&this.remove(),t&&this.add(t),this.currVal=t,!0)}add(t){let e=this.elmVN.elm;this.dragSourceHandler="ownerSVGElement"in e?new B(e,t):new N(e,t),this.dragSourceHandler.init()}remove(){this.dragSourceHandler&&(this.dragSourceHandler.term(),this.dragSourceHandler=void 0)}}),i.registerCustomAttribute("dragTarget",class{constructor(t,e){this.elmVN=t,this.currVal=e,this.add(e)}terminate(t){this.remove(),this.elmVN=void 0}update(t){return this.currVal!==t&&(this.currVal&&this.remove(),t&&this.add(t),this.currVal=t,!0)}add(t){let e=this.elmVN.elm;this.dragTargetHandler=new I(e,t),this.dragTargetHandler.init()}remove(){this.dragTargetHandler&&(this.dragTargetHandler.term(),this.dragTargetHandler=void 0)}})},294:e=>{e.exports=t},868:t=>{t.exports=e},509:t=>{t.exports=s}},r={};function o(t){if(r[t])return r[t].exports;var e=r[t]={exports:{}};return i[t](e,e.exports,o),e.exports}return o.d=(t,e)=>{for(var s in e)o.o(e,s)&&!o.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o(84)})()}));
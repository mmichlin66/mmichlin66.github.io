!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.mimurl=t():e.mimurl=t()}(this,(function(){return(()=>{"use strict";var e={378:(e,t,r)=>{function n(e){return/^[a-z0-9_\-]+$/i.test(e)}function s(e){return/^[a-z0-9_\-\.%]+$/i.test(e)}function a(e){return/^[a-z0-9_\-]+$/i.test(e)}let i,o,l,h;function u(){return l>=o}function c(e){if(l===o){let t="Unexpected end of URL pattern";throw e&&(t+=": "+e),new L(t)}}function f(e=1){return l<=o-e?(l+=e,h=i[l],!0):(l=o,!1)}r.r(t),r.d(t,{EUrlPart:()=>k,FieldFormat:()=>H,match:()=>_,parseURL:()=>B,parseUrlPattern:()=>M});class p{constructor(){this.patternString=i,this.parts=[]}get protocol(){return this.parts[k.Protocol]}get hostname(){return this.parts[k.Hostname]}get port(){return this.parts[k.Port]}get path(){return this.parts[k.Path]}get query(){return this.parts[k.Query]}get hash(){return this.parts[k.Hash]}parse(){for(let e=this.findFirstUrlPart();null!==e&&(e.parse(),this.parts[e.urlPart]=e,!u());e=e.getNextUrlPart());}findFirstUrlPart(){if("/"===h)return o>1&&"/"===i[1]?(f(2),new y):(f(),new b);{let e=i.indexOf("://");if(e>0)return new x;if(e<0)return new y;throw new L("URL pattern cannot start from '://'")}}}class d{constructor(){this.location={start:l,length:0}}finalize(){this.location.length=l-this.location.start,this.tokenSting=i.substr(this.location.start,this.location.length)}}class m extends d{constructor(e,t){super(),this.urlPart=e,this.caseSensitive=t}}class g extends m{constructor(e,t){super(e,t)}parse(){let e=new U;e.parse(this.getSegmentEndCharacters(),!1,this.caseSensitive),this.segment=e,this.finalize()}getSegments(){return[this.segment]}}class w extends m{constructor(e,t){super(e,t),this.segments=[]}parse(){let e=this.getPartEndCharacters();for(;!u();){let t=new U;if(t.parse(this.getSegmentEndCharacters(),!0,this.caseSensitive),this.segments.push(t),e.indexOf(h)>=0)break;f()}this.finalize()}getSegments(){return this.segments}}class x extends g{constructor(){super(k.Protocol,!1)}getSegmentEndCharacters(){return":"}getNextUrlPart(){if(":"===h&&l+2<o&&"/"===i[l+1]&&"/"===i[l+2])return f(3),c(),new y;throw new L("Invalid characters after protocol part")}}class y extends w{constructor(){super(k.Hostname,!1)}getSegmentEndCharacters(){return".:/?#"}getPartEndCharacters(){return":/?#"}getNextUrlPart(){if(":"===h)return f(),c("Port cannot be empty"),new $;if("/"===h)return f(),u()?null:new b;if("?"===h)return f(),u()?null:new P;if("#"===h)return f(),u()?null:new v;throw new L(`Invalid character '${h}' after hostname segment`)}}class $ extends g{constructor(){super(k.Port,!1)}getSegmentEndCharacters(){return"/?#"}getNextUrlPart(){if("/"===h)return f(),u()?null:new b;if("?"===h)return f(),u()?null:new P;if("#"===h)return f(),u()?null:new v;throw new L(`Invalid character '${h}' after port part`)}}class b extends w{constructor(){super(k.Path,!0)}getSegmentEndCharacters(){return"/?#"}getPartEndCharacters(){return"?#"}getNextUrlPart(){if("?"===h)return f(),u()?null:new P;if("#"===h)return f(),u()?null:new v;throw new L(`Invalid character '${h}' after path segment`)}}class P extends m{constructor(){super(k.Query,!0),this.parsedQSPs={},this.allowExtraQueryParams=!0}parse(){for(;!u()&&"#"!==h;)if("!"===h)this.allowExtraQueryParams=!1,f();else{let e=new E;if(e.parse(),e.name in this.parsedQSPs)throw new L(`Query string parameter '${e.name}' appears more than once`);this.parsedQSPs[e.name]=e,"&"===h&&f()}this.finalize()}getNextUrlPart(){if("#"===h)return f(),u()?null:new v;throw new L(`Invalid character '${h}' after query string segment`)}getSegments(){let e=[];for(let t in this.parsedQSPs)e.push(this.parsedQSPs[t].segment);return e}}class v extends g{constructor(){super(k.Hash,!0)}getSegmentEndCharacters(){return""}getNextUrlPart(){return null}}class E extends d{constructor(){super(),this.name=""}parse(){for(;!u()&&"=&#".indexOf(h)<0;)this.name+=h,f();if(!this.name)throw new L("Query string parameter doesn't have name");if(e=this.name,!/^[a-z0-9_\-]+$/i.test(e))throw new L(`Query string parameter name '${this.name}' contains invalid character`);var e;if(u()||"="!==h)throw new L(`Query string parameter '${this.name}' must be followed by '='`);f(),c(`Query string parameter '${this.name}' doesn't have value`);let t=new U;t.parse("&#",!0,!0),this.segment=t,this.finalize()}isNameEndCharacter(e){return"=&#".indexOf(e)>=0}}class U extends d{constructor(){super(),this.isOptional=!1,this.isMulti=!1,this.fields=[]}parse(e,t,r){this.analizeFirstChar(e,t)&&f();let n=[];for(;!u()&&e.indexOf(h)<0;){let t;if("{"===h){let r=new O;r.parse(e),t=r}else if("("===h){let e=new R;e.parse(),t=e}else{let r=new S;r.parse(e+"{("),t=r}n.push(t)}this.generateRegExp(n,r),this.finalize()}analizeFirstChar(e,t){switch(h){case"?":return this.isOptional=!0,!0;case"!":return!0;case"*":if(!t)throw new L("Single-value segment URL part cannot start from '*'");return this.isOptional=this.isMulti=!0,!0;case"+":if(!t)throw new L("Single-segment URL part cannot start from '+'");return this.isMulti=!0,!0;default:if(e.indexOf(h)>=0)throw new L("Empty segment encountered");return!1}}generateRegExp(e,t){let r=1,n="";if(0===e.length)n+=".+";else for(let t of e)t instanceof S?n+=t.content:t instanceof R?(n+="("+t.content+")",r+=1+t.capturingGroupQty):(t.isArray=this.isMulti,t.index=r,this.fields.push(t),n+=this.generateRegExpSectionForField(t),r++,t.matchPattern&&(r+=1+t.matchPattern.capturingGroupQty));this.regExp=new RegExp(n,t?"":"i")}generateRegExpSectionForField(e){let t="";return e.matchPattern&&e.matchPattern.content?(t+=e.matchPattern.content,e.isOptional&&(t+="?")):e.isOptional?t+="(.*)":t+="(.+)",t}}class S extends d{constructor(){super(),this.content=""}parse(e){let t="";for(;!u()&&e.indexOf(h)<0;)t+=h,f();if(!function(e){return/^[a-z0-9_\-\.%]+$/i.test(e)}(t))throw new L(`Text token '${t}' contains invalid characters`);try{this.content=decodeURIComponent(t)}catch(e){throw new L(`Text token '${t}' cannot be URL-decoded. Error: ${e.message}`)}this.finalize()}}class R extends d{constructor(){super(),this.content="",this.capturingGroupQty=0}parse(){let e=[];for(;!u();){let t=h;if(")"===t){if("("!==e.pop())throw new L(`Non-matching character '${t}' in regular expression`);if(f(),0===e.length)return this.content+=t,void this.finalize()}else if("}"===t){if("{"!==e.pop())throw new L(`Non-matching character '${t}' in regular expression`);f()}else if("]"===t){if("["!==e.pop())throw new L(`Non-matching character '${t}' in regular expression`);f()}else"({[".indexOf(t)>=0?("("===t&&this.capturingGroupQty++,e.push(t),f()):"\\"===t?(this.content+=t,f(),c(`In the Regexp '${this.content}', the escape character '\\' must be followed by another character`),t=h,f()):f();this.content+=t}throw new L("Invalid URL pattern end within regular expression")}finalize(){if(!this.content)throw new L("Empty regular expression");super.finalize()}}class O extends d{constructor(){super(),this.isOptional=!1,this.name="",this.format=H.String,this.matchPattern=null}parse(e){for(f(),c("A field must define a name"),"?"===h&&(this.isOptional=!0,f());!u();){if(e.indexOf(h)>=0)throw new L("Field doesn't have closing '}'");if("}(%=".indexOf(h)>=0)break;this.name+=h,f()}if(0===this.name.length)throw new L("Field must have name");if(t=this.name,!/^[a-z_][a-z0-9_]*$/i.test(t))throw new L(`Field name '${this.name}' contains invalid characters`);var t;if(c(`Field '${this.name}' doesn't have closing '}'`),"%"===h){f(),c(`Field '${this.name}' doesn't specify format after '%'`);let e=h;if("i"===e)this.format=H.Integer,f();else if("f"===e)this.format=H.Float,f();else{if("b"!==e)throw new L(`Field '${this.name}' has invalid format character '${h}'`);this.format=H.Boolean,f()}c(`Field '${this.name}' doesn't have closing '}'`)}if("("===h){let e=new R;e.parse(),this.matchPattern=e,c(`Field '${this.name}' doesn't have closing '}'`)}if("="===h)this.isOptional=!0,f(),this.parseDefaultValue(e);else switch(this.format){case H.Integer:case H.Float:this.defaultValue=NaN;break;case H.Boolean:this.defaultValue=void 0;break;default:this.defaultValue=""}if("}"!==h)throw new L(`Field '${this.name}' has invalid character '${h}'`);this.finalize(),f()}parseDefaultValue(e){let t="";for(;!u();){if(e.indexOf(h)>=0)throw new L(`Field '${this.name}' doesn't have closing '}'`);if("}"===h)break;t+=h,f()}if(!t)throw new L(`Field '${this.name}' default value cannot be empty`);if(t=decodeURIComponent(t),this.format===H.Integer){if(this.defaultValue=Number(t),isNaN(this.defaultValue)||!Number.isInteger(this.defaultValue))throw new L(`Default value '${t}' of Integer field '${this.name}' cannot be converted to Integer`)}else if(this.format===H.Float){if(this.defaultValue=Number(t),isNaN(this.defaultValue))throw new L(`Default value of '${t}' Float field '${this.name}' cannot be converted to Float`)}else if(this.format===H.Boolean){let e=t.toLowerCase();if("true"===e||"t"===e||"yes"===e||"y"===e||"1"===e)this.defaultValue=!0;else{if("false"!==e&&"f"!==e&&"no"!==e&&"n"!==e&&"0"!==e)throw new L(`Default value of '${t}' Boolean field '${this.name}' cannot be converted to Boolean`);this.defaultValue=!1}}else this.defaultValue=t}}class L extends Error{constructor(e){super(),this.pos=l,this.message=`Error at position ${this.pos}: ${e}`}}function F(e,t,r,n){return"number"==typeof t&&(t=t.toString()),r?t?N(t,r,n)?null:`URL segment '${t}' in part '${k[e]}' doesn't match pattern segment '${r.tokenSting}'`:r.isOptional?null:`URL part '${k[e]}' doesn't have a segment corresponding to a mandatory pattern segment '${r.tokenSting}'`:t?`URL part '${k[e]}' contains segment '${t}' that doesn't exist in the pattern`:null}function N(e,t,r){let n=t.regExp.exec(e);if(!n||n[0]!==e)return!1;for(let e of t.fields){if(e.index>=n.length)return console.error("BUG: Field index not found in patter's regular expression execution result"),!1;let t=V(e,n[e.index]);if(e.isArray){let n=r[e.name];void 0===n&&(n=[],r[e.name]=n),n.push(t)}else r[e.name]=t}return!0}function Q(e,t,r,n){if(!t&&!r)return null;if(!t)return`URL doesn't have part '${k[e]}' that exists in the pattern`;if(!r)return`URL has part '${k[e]}' that doesn't exist in the pattern`;let s=[];for(let e of r)e.isMulti&&!e.isOptional?(s.push(new C(e,!1)),s.push(new C(e,!0))):s.push(new C(e,e.isOptional));return I(t,0,s,0,n)?null:`URL part '${k[e]}' doesn't match the pattern`}function I(e,t,r,n,s){let a=t,i=n;for(;i<r.length&&a<e.length;){let t=r[i],n=e[a];if(t.isOptional){let o={};if(I(e,a,r,i+1,o))return z(s,o),!0;if(o={},!N(n,t.parsedSegment,o))return!1;z(s,o),a++,t.parsedSegment.isMulti||i++}else{if(!N(n,t.parsedSegment,s))return!1;i++,a++}}if(i===r.length&&a===e.length)return!0;if(i===r.length)return!1;for(let e=i;e<r.length;e++)if(!r[e].isOptional)return!1;return!0}function z(e,t){for(let r in t){let n=t[r],s=e[r];if(void 0===s)e[r]=n;else{let e=n,t=s;for(let r of e)t.push(r)}}}function V(e,t){if(!t)return e.defaultValue;switch(e.format){case H.Integer:{let r=Number(t);return isNaN(r)||!Number.isInteger(r)?e.defaultValue:r}case H.Float:{let r=Number(t);return isNaN(r)?e.defaultValue:r}case H.Boolean:{let r=t.toLowerCase();return"true"===r||"t"===r||"yes"===r||"y"===r||"1"===r||"false"!==r&&"f"!==r&&"no"!==r&&"n"!==r&&"0"!==r&&e.defaultValue}default:return t}}class C{constructor(e,t){this.parsedSegment=e,this.isOptional=t}}class q{get success(){return!this.errors||0===this.errors.length}}var k,H;function B(e){return function(e){let t,r={},i=e.indexOf("://");if(0===i)throw new Error("URL cannot start from '://'");if(i>0){if(r.protocol=e.substr(0,i),o=r.protocol,!/^[a-z0-9]+$/i.test(o))throw new Error(`Protocol '${r.protocol}' contains invalid characters`);t=i+3}else t="/"===e[0]?-1:0;var o;let l=t<0?0:t,h=e.indexOf(":",l),u=e.indexOf("/",l),c=e.indexOf("?",l),f=e.indexOf("#",l);if(t>=0){r.hostname=h>0?e.substr(t,h-t).split("."):u>0?e.substr(t,u-t).split("."):c>0?e.substr(t,c-t).split("."):f>0?e.substr(t,f-t).split("."):e.substr(t).split(".");for(let e=0;e<r.hostname.length;e++){let t=r.hostname[e];if(!n(t))throw new Error(`Hostname segment '${t}' contains invalid characters`)}}if(h>0){let t;if(t=u>0?e.substr(h+1,u-h-1):c>0?e.substr(h+1,c-h-1):f>0?e.substr(h+1,f-h-1):e.substr(h+1),!function(e){return/^\d+$/i.test(e)}(t))throw new Error(`Port '${t}' contains non-numerical characters`);r.port=Number(t)}if(u>=0){r.path=c>0?e.substr(u+1,c-u-1).split("/"):f>0?e.substr(u+1,f-u-1).split("/"):e.substr(u+1).split("/");for(let e=0;e<r.path.length;e++){let t=r.path[e];if(!s(t))throw new Error(`Path segment '${t}' contains invalid characters`);try{t=decodeURIComponent(t)}catch(e){throw new Error(`Path segment '${t}' cannot be URL-decoded. Error: ${e.message}`)}r.path[e]=t}}if(c>0){let t;r.query={},t=f>0?e.substr(c+1,f-c-1):e.substr(c+1);let n=t.split("&");for(let e of n){if(!e)throw new Error("Invalid stucture of query string URL part");let t,n,i=e.split("=");if(i.length>2)throw new Error(`Query string parameter '${e}' has more than one '=' symbol`);if(i.length<2?(t=e,n=void 0):(t=i[0],n=i[1]),!a(this.name))throw new Error(`Query string parameter name '${t}' contains invalid character`);if(n){if(!s(n))throw new Error(`Value '${n}' of query string parameter '${t}' contains invalid characters`);try{n=decodeURIComponent(n)}catch(e){throw new Error(`Value '${n}' of query string parameter '${t}' cannot be URL-decoded. Error: ${e.message}`)}}t in r.query?r.query[t].push(n):r.query[t]=[n]}}if(f>0){let t=e.substr(f+1);if(!s(t))throw new Error(`Value '${t}' of hash URL part contains invalid characters`);try{r.hash=decodeURIComponent(t)}catch(e){throw new Error(`Value '${t}' of hash URL part cannot be URL-decoded. Error: ${e.message}`)}}return r}(e)}function M(e){return function(e){if(i=e,o=0,l=0,h="",!e)throw new L("URL pattern cannot be empty");o=e.length,h=e[0];let t=new p;return t.parse(),t}(e)}function _(e,t){return function(e,t){if(!e)throw new Error("URL cannot be null or empty string");if(!t)throw new Error("Pattern cannot be null or empty string");return function(e,t){if(!e)throw new Error("URL cannot be null");if(!t)throw new Error("parsedPattern cannot be null");let r=new q;r.parsedURL=e,r.fields={};let n=[];try{let s=F(k.Protocol,e.protocol,t.protocol?t.protocol.segment:null,r.fields);s&&n.push(s),s=Q(k.Hostname,e.hostname,t.hostname?t.hostname.segments:null,r.fields),s&&n.push(s),s=F(k.Port,e.port,t.port?t.port.segment:null,r.fields),s&&n.push(s),s=Q(k.Path,e.path,t.path?t.path.segments:null,r.fields),s&&n.push(s),s=function(e,t,r){if(!t)return null;if(!e)return 0===Object.keys(t.parsedQSPs).length?null:"URL doesn't have query string parameters specified in the pattern";for(let r in t.parsedQSPs)if(void 0===e[r])return`URL doesn't have query string parameter '${r}'`;for(let n in e){let s=t.parsedQSPs[n].segment;if(s){let t=e[n];if(!s.isMulti&&t.length>1)return`URL has multiple values for query string parameter '${n}' while pattern doesn't specify it as multi`;for(let e of t)if(!N(e,s,r))return`URL's query string parameter '${n}' doesn't match that specified in the pattern`}else if(!t.allowExtraQueryParams)return`URL has query string parameter '${n}' that is not specified in the pattern`}return null}(e.query,t.query,r.fields),s&&n.push(s),s=F(k.Hash,e.hash,t.hash?t.hash.segment:null,r.fields),s&&n.push(s)}catch(e){n.push(e.message)}return n.length>0&&(r.errors=n),r}("string"==typeof e?B(e):e,"string"==typeof t?M(t):t)}(e,t)}!function(e){e[e.Protocol=0]="Protocol",e[e.Hostname=1]="Hostname",e[e.Port=2]="Port",e[e.Path=3]="Path",e[e.Query=4]="Query",e[e.Hash=5]="Hash"}(k||(k={})),function(e){e[e.String=0]="String",e[e.Integer=1]="Integer",e[e.Float=2]="Float",e[e.Boolean=3]="Boolean"}(H||(H={}))}},t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={exports:{}};return e[n](s,s.exports,r),s.exports}return r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(378)})()}));
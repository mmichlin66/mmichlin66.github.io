!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("mimbl"),require("mimurl"),require("mimcss")):"function"==typeof define&&define.amd?define(["mimbl","mimurl","mimcss"],t):"object"==typeof exports?exports.mimcl=t(require("mimbl"),require("mimurl"),require("mimcss")):e.mimcl=t(e.mimbl,e.mimurl,e.mimcss)}(this,(function(e,t,s){return function(e){var t={};function s(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,s),i.l=!0,i.exports}return s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(r,i,function(t){return e[t]}.bind(null,i));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=8)}([function(t,s){t.exports=e},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DNDTYPE_ELEMENT=void 0,t.DNDTYPE_ELEMENT="application/DOMElement"},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Popup=void 0;const r=s(0);class i extends r.Component{constructor(e){super(),this.onKeyDown=e=>{27===e.keyCode&&e.preventDefault()},this.onMove=e=>{this.move(e.clientX-this.dragPointOffsetX,e.clientY-this.dragPointOffsetY)},this.onStopMove=e=>{window.removeEventListener("mousemove",this.onMove),window.removeEventListener("mouseup",this.onStopMove)},this.caption=new r.Ref,this.dlgSlice=e||{},i.DefaultDlgSlice||(i.DefaultDlgSlice={style:{borderStyle:"solid",borderWidth:1,padding:"0"}})}open(e,t){if(this.isOpen())return!1;this.create(e,t),this.dlg.show()}close(e){this.dlg.close(),this.destroy(),this.modalPromiseResolveFunc&&(this.modalPromiseResolveFunc(e),this.modalPromiseResolveFunc=void 0)}showModal(e,t){if(this.isOpen())return Promise.reject("Dialog is already open");let s=new Promise(e=>{this.modalPromiseResolveFunc=e});return this.create(e,t),this.dlg.showModal(),s}isOpen(){return void 0!==this.dlg}isModeless(){return this.isOpen()&&void 0===this.modalPromiseResolveFunc}isModal(){return this.isOpen()&&void 0!==this.modalPromiseResolveFunc}startMove(e){e.preventDefault(),e.stopPropagation();let t=this.dlg.getBoundingClientRect();this.dragPointOffsetX=e.clientX-t.left,this.dragPointOffsetY=e.clientY-t.top,this.dlg.style.margin=this.currDlgSlice.style.margin="0",this.currDlgSlice.style.top=t.top,this.currDlgSlice.style.left=t.left,this.dlg.style.top=this.currDlgSlice.style.top+"px",this.dlg.style.left=this.currDlgSlice.style.left+"px",window.addEventListener("mousemove",this.onMove),window.addEventListener("mouseup",this.onStopMove)}move(e,t){e<0?e=0:e+30>window.innerWidth&&(e=window.innerWidth-30),t<0?t=0:t+30>window.innerHeight&&(t=window.innerHeight-30),this.currDlgSlice.style.left=e,this.currDlgSlice.style.top=t,this.dlg.style.left=this.currDlgSlice.style.left+"px",this.dlg.style.top=this.currDlgSlice.style.top+"px"}render(){if(!this.currDlgSlice){let e={position:"fixed"};void 0===this.initialX?(e.left=0,e.right=0):(e.left=this.initialX,e.marginLeft="0",e.marginRight="0"),void 0===this.initialY?(e.top=0,e.bottom=0):(e.top=this.initialY,e.marginTop="0",e.marginBottom="0"),this.currDlgSlice=r.mergeSlices(i.DefaultDlgSlice,this.getDlgSlice(),{style:e})}return r.jsx("dialog",Object.assign({ref:e=>this.dlg=e,style:this.currDlgSlice.style,class:this.currDlgSlice.className},this.currDlgSlice.props),this.currDlgSlice.content)}getDlgSlice(){return this.dlgSlice}create(e,t){this.initialX=e,this.initialY=t,this.anchorDiv=document.createElement("div"),document.body.appendChild(this.anchorDiv),r.mount(this,this.anchorDiv),window.addEventListener("keydown",this.onKeyDown)}destroy(){window.removeEventListener("keydown",this.onKeyDown),r.unmount(this.anchorDiv),this.anchorDiv.remove()}get DlgSlice(){return this.DlgSlice}}t.Popup=i},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DialogButton=t.Dialog=void 0;const r=s(0),i=s(2);class o extends i.Popup{constructor(e,t,s,r){super(r),this.onStartMove=e=>{this.startMove(e)},this.buttonInfos=[],this.captionAreaSlice=e||{},this.mainAreaSlice=t||{},this.buttonAreaSlice=s||{},o.DefaultCaptionAreaSlice||(o.DefaultCaptionAreaSlice={style:{background:"pink",padding:"0.5em 1em",cursor:"default"}}),o.DefaultMainAreaSlice||(o.DefaultMainAreaSlice={style:{padding:"0.5em 1em"}}),o.DefaultButtonAreaSlice||(o.DefaultButtonAreaSlice={style:{display:"flex",justifyContent:"flex-end",padding:"0.5em 1em"}}),o.DefaultButtonSlice||(o.DefaultButtonSlice={style:{marginLeft:"0.5em",minWidth:"5em"}})}addButton(e,t,s,i){let o={slice:e,key:t,callback:s,ref:new r.Ref};void 0===i?this.buttonInfos.push(o):0===i?this.buttonInfos.unshift(o):this.buttonInfos.splice(i-1,0,o),this.updateMe(this.renderButtonArea)}removeButton(e){this.buttonInfos.splice(e,1),this.updateMe(this.renderButtonArea)}renderCaptionArea(){let e=r.mergeSlices(o.DefaultCaptionAreaSlice,this.getCaptionAreaSlice());return r.jsx("div",Object.assign({id:"dlgCaption",mousedown:this.onStartMove,style:e.style,class:e.className},e.props),e.content)}renderMainArea(){let e=r.mergeSlices(o.DefaultMainAreaSlice,this.getMainAreaSlice());return r.jsx("div",Object.assign({id:"dlgMainContent",style:e.style,class:e.className},e.props),e.content)}renderButtonArea(){let e=r.mergeSlices(o.DefaultButtonAreaSlice,this.getButtonAreaSlice());return r.jsx("div",Object.assign({id:"dlgButtons",style:e.style,class:e.className},e.props),e.content,this.buttonInfos.map(e=>{let t=r.mergeSlices(o.DefaultButtonSlice,e.slice);return r.jsx("button",Object.assign({key:e.key,click:e.callback&&(()=>e.callback(e.key)),style:t.style,class:t.className},t.props),t.content)}))}getDlgSlice(){return{content:r.jsx(r.Fragment,null,this.renderCaptionArea,this.renderMainArea,this.renderButtonArea)}}getCaptionAreaSlice(){return this.captionAreaSlice}getMainAreaSlice(){return this.mainAreaSlice}getButtonAreaSlice(){return this.buttonAreaSlice}get CaptionAreaSlice(){return this.captionAreaSlice}set CaptionAreaSlice(e){this.captionAreaSlice=e}get MainAreaSlice(){return this.mainAreaSlice}set MainAreaSlice(e){this.mainAreaSlice=e}get ButtonAreaSlice(){return this.buttonAreaSlice}set ButtonAreaSlice(e){this.buttonAreaSlice=e}}t.Dialog=o,function(e){e[e.None=0]="None",e[e.OK=1]="OK",e[e.Cancel=2]="Cancel",e[e.Yes=4]="Yes",e[e.No=8]="No",e[e.Close=16]="Close"}(t.DialogButton||(t.DialogButton={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TreeNodeContainer=void 0;const r=s(0);class i extends r.Component{constructor(e){super(),this.nodes=[],this.nodeFactory=e}addNode(e,t){let s=this.nodes.length,r=this.nodeFactory();if(null==t||t<0||t>=s)r.index=s,this.nodes.push(r);else{r.index=t,this.nodes.splice(t,0,r);for(let e=t+1;e<s;e++)this[e].index=e}return r.content=e.content,r.icon=e.icon,r.textColor=e.textColor,r.bgColor=e.bgColor,r.italic=e.italic,r.bold=e.bold,r.customClass=e.customClass,r.data=e.data,this.updateMe(),r}removeNode(e){let t=this.nodes.length;if(e<0||e>=t)throw new Error("replaceNode: invalid index "+e);this.nodes.splice(e,1);for(let s=e;s<t;s++)this[s].index=s;this.updateMe()}removeAllNodes(){let e=this.nodes.length;e>0&&(this.nodes.splice(0,e),this.updateMe())}expandAll(){for(let e of this.nodes)e.expandAll()}collapseAll(){for(let e of this.nodes)e.collapseAll()}render(){return this.nodes}}t.TreeNodeContainer=i},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ComponentWithLocalStyles=void 0;const r=s(0),i=s(15);class o extends r.Component{constructor(e=null){super(e),this.m_uniqueID=Math.floor(1e9*Math.random()).toString(),this.rules=new Map,this.ruleNames=[],this.styleElm=document.createElement("style"),this.styleElm.id=this.m_uniqueID,document.head.appendChild(this.styleElm)}get uniqueID(){return this.m_uniqueID}decorateName(e){return e+this.m_uniqueID}createStyleRule(e,t,s){let r=this.createDummyRule(e,"dummy {}"),i=r.cssomRule,o=new a(this.uniqueID,i);return t&&o.setSelector(t),s&&o.setProperties(s),r.mcssRule=o,o}getRule(e){let t=this.rules.get(e);return void 0===t?void 0:t.mcssRule}removeRule(e){}willMount(){this.vn.publishService("LocalStyles",this)}willUnmount(){this.vn.unpublishService("LocalStyles"),this.styleElm.remove()}createDummyRule(e,t){let s=this.rules.get(e);void 0!==s&&this.removeRule(e);let r=this.ruleNames.length,i=this.styleElm.sheet;i.insertRule(t,r);let o=i.rules[r];return this.ruleNames.push(e),s={mcssRule:null,cssomRule:o,index:r},this.rules.set(e,s),s}}t.ComponentWithLocalStyles=o;class a extends class{constructor(e,t){this.uniqueID=e,this.cssomRule=t}decorate(e){return e+this.uniqueID}replace(e){return e.replace("(*)",this.uniqueID)}}{constructor(e,t){super(e,t)}setSelector(e){this.cssomRule.selectorText=this.replace(e)}setProperty(e,t,s){this.cssomRule.style.setProperty(this.replace(e),this.replace(t),s?"important":void 0)}setProperties(e){if(e)for(let t in e){let s=i.getStylePropValue(t,e[t]);this.cssomRule.style[this.replace(t)]=this.replace(s)}}removeProperty(e){this.cssomRule.style.removeProperty(this.replace(e))}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScrollAxisAction=t.ScrollAxis=void 0;t.ScrollAxis=class{constructor(e,t,s){this.minOverscan=e,this.optOverscan=t,this.maxOverscan=s}measure(e,t,s,i,o,a,n,l){let h=new r;if(0===e)return h;if(0===s)throw new Error("itemCount cannot be zero");let c=t+s-1,d=e-1,u=n/s;i&&(u=(u+i)/2);let p=Math.min(Math.floor(l/u),d),m=Math.min(Math.ceil((l+o)/u),d),g=Math.max(p-this.minOverscan,0),f=Math.max(p-this.optOverscan,0),v=Math.max(p-this.maxOverscan,0),D=Math.min(m+this.minOverscan,d),E=Math.min(m+this.optOverscan,d),b=Math.min(m+this.maxOverscan,d),w=t>g||t<v?f:t,y=c<D||c>b?E:c;return w>y&&console.error(`Wrong ScrollAxis calculation: newFirst '${w}' is greater than newLast '${y}'`),h.newFirst=w,h.newLast=y,h.newAvgItemSize=u,h.newWallSize=Math.ceil(e*u),h.newSubsetOffset=Math.ceil(w*u),w==t&&y==c?h.noAddRemoveNeeded=!0:w>c||y<t?h.neeedToRemoveAllItems=!0:(w<t?h.countToAddAtStart=t-w:w>t&&(h.countToRemoveAtStart=w-t),y<c?h.countToRemoveAtEnd=c-y:y>c&&(h.countToAddAtEnd=y-c)),h}};class r{constructor(){this.newAvgItemSize=0,this.newWallSize=0,this.newSubsetOffset=0,this.newFirst=0,this.newLast=0,this.noAddRemoveNeeded=!1,this.neeedToRemoveAllItems=!1,this.countToRemoveAtStart=0,this.countToRemoveAtEnd=0,this.countToAddAtStart=0,this.countToAddAtEnd=0}}t.ScrollAxisAction=r},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EmulLegacyDataTransfer=t.EmulDataTransfer=t.DragAndDropData=void 0;class r{static setObjectData(e,t){e&&void 0!==t&&r.dataMap.set(e,t)}static getObjectData(e){return r.dataMap.get(e)}static removeObjectData(e){r.dataMap.delete(e)}static clearAllObjectData(){r.dataMap.clear()}static hasType(e,t){return e.types.indexOf?e.types.indexOf(t)>=0:e.types.contains(t)}}t.DragAndDropData=r,r.dataMap=new Map;class i extends DataTransfer{constructor(){super(),this.isImageElmReset=!1,this.dataMap=new Map,this.dataFormats=[]}setDragImage(e,t,s){this.imageElm=e,this.imageElmX=t,this.imageElmY=s,super.setDragImage&&super.setDragImage(e,t,s),this.isImageElmReset=!0}set effectAllowed(e){this.effectAllowedEx=e,super.effectAllowed=e}get effectAllowed(){return void 0===this.effectAllowedEx?super.effectAllowed:this.effectAllowedEx}set dropEffect(e){this.dropEffectEx=e,super.dropEffect=e}get dropEffect(){return void 0===this.dropEffectEx?super.dropEffect:this.dropEffectEx}setData(e,t){return super.setData(e,t),this.dataMap.set(e,t),this.dataFormats=Array.from(this.dataMap.keys()),!0}getData(e){let t=this.dataMap.get(e);return void 0===t?"":t}clearData(e){return super.clearData(e),e?this.dataMap.delete(e):this.dataMap.clear(),this.dataFormats=Array.from(this.dataMap.keys()),!0}get types(){return this.dataFormats}}t.EmulDataTransfer=i;class o extends DataTransfer{constructor(){super(),this.isImageElmReset=!1,this.dataMap=new Map,this.dataFormats=[],this.m_items=null,this.m_files=null}setDragImage(e,t,s){this.imageElm=e,this.imageElmX=t,this.imageElmY=s,this.isImageElmReset=!0}set effectAllowed(e){this.effectAllowedEx=e}get effectAllowed(){return this.effectAllowedEx}set dropEffect(e){this.dropEffectEx=e}get dropEffect(){return this.dropEffectEx}setData(e,t){return this.dataMap.set(e,t),this.dataFormats=Array.from(this.dataMap.keys()),!0}getData(e){let t=this.dataMap.get(e);return void 0===t?"":t}clearData(e){return e?this.dataMap.delete(e):this.dataMap.clear(),this.dataFormats=Array.from(this.dataMap.keys()),!0}get types(){return this.dataFormats}get files(){return this.m_files}get items(){return this.m_items}}t.EmulLegacyDataTransfer=o},function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),i=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||t.hasOwnProperty(s)||r(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),i(s(1),t),i(s(2),t),i(s(3),t),i(s(9),t),i(s(10),t),i(s(12),t),i(s(6),t),i(s(16),t);s(17).registerDragDropCustomAttributes()},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MsgBoxIcon=t.MsgBoxButtons=t.MsgBox=void 0;const r=s(0),i=s(3);class o extends i.Dialog{constructor(e,t,s=a.OK,r=n.None){super(),this.onButtonClicked=e=>{this.close(e)},this.message=e,this.title=t,this.buttons=s,this.icon=r,this.createButtons()}static showModal(e,t,s=a.OK,r=n.None){return new o(e,t,s,r).showModal()}getCaptionAreaSlice(){return{content:this.title,style:{backgroundColor:"dodgerblue"}}}getMainAreaSlice(){let{cls:e,color:t}=this.getIconClassAndColor();return{content:r.jsx("div",{style:{display:"flex",alignItems:"start"}},e&&r.jsx("i",{class:"fa fa-3x "+e,style:{color:t}}),r.jsx("div",{style:{marginLeft:"10px",minWidth:"15em",maxWidth:"40em",minHeight:"2em",maxHeight:"20em",overflow:"auto"}},this.message))}}createButtons(){switch(this.buttons){case a.Close:this.createButton("Close",i.DialogButton.Close);break;case a.OK:this.createButton("OK",i.DialogButton.OK);break;case a.OkCancel:this.createButton("OK",i.DialogButton.OK),this.createButton("Cancel",i.DialogButton.Cancel);break;case a.YesNo:this.createButton("Yes",i.DialogButton.Yes),this.createButton("No",i.DialogButton.No);break;case a.YesNoCancel:this.createButton("Yes",i.DialogButton.Yes),this.createButton("No",i.DialogButton.No),this.createButton("Cancel",i.DialogButton.Cancel)}}getIconClassAndColor(){switch(this.icon){case n.Info:return{cls:"fa-info-circle",color:"blue"};case n.Warning:return{cls:"fa-exclamation-triangle",color:"orange"};case n.Error:return{cls:"fa-minus-circle",color:"red"};case n.Question:return{cls:"fa-question-circle",color:"green"};default:return{cls:"",color:"blue"}}}createButton(e,t){this.addButton({content:e},t,this.onButtonClicked)}}var a,n;t.MsgBox=o,function(e){e[e.None=0]="None",e[e.Close=1]="Close",e[e.OK=2]="OK",e[e.OkCancel=3]="OkCancel",e[e.YesNo=4]="YesNo",e[e.YesNoCancel=5]="YesNoCancel"}(a=t.MsgBoxButtons||(t.MsgBoxButtons={})),function(e){e[e.None=0]="None",e[e.Info=1]="Info",e[e.Warning=2]="Warning",e[e.Error=3]="Error",e[e.Question=4]="Question"}(n=t.MsgBoxIcon||(t.MsgBoxIcon={}))},function(e,t,s){"use strict";var r=this&&this.__rest||function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]])}return s};Object.defineProperty(t,"__esModule",{value:!0}),t.Link=t.Router=void 0;const i=s(11),o=s(0);class a extends o.Component{constructor(e){if(super(),this.onPopstate=e=>{let t=e.state;t&&(t.routeID?this.navigateByID(t.routeID,t.fields):t.routeURL?this.navigateByURL(t.routeURL):console.log("Route state in popstate event has neither route ID nor path."))},this.routes=[],this.routesByID=new Map,this.error=null,this.errorPath=null,this.props=e,this.props.children)for(let e of this.props.children)this.addRoute(e)}addRoute(e,t){if(!e)throw new Error("Route object cannot be null");void 0!==t?this.routes.splice(t,0,e):this.routes.push(e),this.addRouteToMap(e)}removeRoute(e){let t=this.routes.splice(e,1)[0];return this.removeRouteFromMap(t),t}addRouteToMap(e){if(e.id&&this.routesByID.set(e.id,e),e.subRoutes)for(let t of e.subRoutes)this.addRouteToMap(t)}removeRouteFromMap(e){if(e.id&&this.routesByID.delete(e.id),e.subRoutes)for(let t of e.subRoutes)this.removeRouteFromMap(t)}navigateByURL(e,t=!1){let[s,r]=this.findRouteByURL(e);s?this.navigateToRoute(s,e,r,t):this.higherRouterService&&this.higherRouterService.r.navigateByURL(e,t)}navigateByID(e,t,s){let r,i=this.routesByID.get(e);i?(this.controlsBrowser&&(r=i.urlPattern),this.navigateToRoute(i,r,t,s)):this.higherRouterService&&this.higherRouterService.r.navigateByID(e,t)}findRouteByURL(e){return a.findRouteRecursiveByURL(e,this.routes)}static findRouteRecursiveByURL(e,t){for(let s of t){let t=i.match(e,s.urlPattern);if(t&&t.success)return[s,t.fields];if(s.subRoutes){let t=a.findRouteRecursiveByURL(e,s.subRoutes);if(t[0])return t}}return[null,null]}async navigateToRoute(e,t,s,r){if(this.currRoute&&this.currRoute.navFromFunc){let e=this.currRoute.navFromFunc();if(e instanceof Promise&&(e=await e),!e)return}if(this.controlsBrowser&&r){let r={routeID:e.id,routeURL:t,fields:s};history.pushState(r,"",t)}this.currRoute=e;let i=e.navToFunc?e.navToFunc(s):null;this.currRouteContent=i instanceof Promise?await i:i,this.updateMe()}reportError(e,t){this.handleError(e,t),this.updateMe()}willMount(){this.vn.publishService("StdErrorHandling",this),this.vn.publishService("Router",this),this.chainsToHigherRouter&&(this.higherRouterService=new o.Ref,this.vn.subscribeService("Router",this.higherRouterService,void 0,!1));let e=this.routes.length>0?this.routes[0]:null;if(!e)return;this.currRoute=e;let t=e.navToFunc?e.navToFunc({}):null;if(t instanceof Promise?(this.currRouteContent="Please wait while content is loading...",t.then(e=>{this.currRouteContent=e,this.updateMe})):this.currRouteContent=t,this.controlsBrowser){this.baseURL,window.addEventListener("popstate",this.onPopstate);let t={routeID:e.id,routeURL:e.urlPattern,fields:null};history.replaceState(t,"",e.urlPattern)}}willUnmount(){this.controlsBrowser&&window.removeEventListener("popstate",this.onPopstate),this.chainsToHigherRouter&&(this.vn.unsubscribeService("Router"),this.higherRouterService=void 0),this.vn.unpublishService("Router"),this.vn.unpublishService("StdErrorHandling")}render(){return this.virtRender(this.currRouteContent)}handleError(e,t){this.currRouteContent=o.jsx("div",{id:"rootError",style:{backgroundColor:"pink",display:"flex",flexDirection:"column",alignItems:"start"}},e,t&&t.map(e=>o.jsx("span",null,e)))}virtRender(e){return e}get controlsBrowser(){return void 0===this.props.controlsBrowser||this.props.controlsBrowser}get chainsToHigherRouter(){return void 0===this.props.chainsToHigherRouter||this.props.chainsToHigherRouter}get baseURL(){return void 0===this.props.baseURL?"":this.props.baseURL}set OuterContentFunc(e){this.outerContentFunc=e}set ProgressContentFunc(e){this.progressContentFunc=e}}t.Router=a;class n extends o.Component{constructor(e){super(e)}render(){let e=this.props,{routeURL:t,routeID:s,fields:i,makeHistoryEntry:a}=e,n=r(e,["routeURL","routeID","fields","makeHistoryEntry"]);return o.jsx("a",Object.assign({href:"#",click:this.onClick},n),this.props.children)}onClick(e){e.preventDefault();let t=this.vn.getService("Router");t&&(this.props.routeID?t.navigateByID(this.props.routeID,this.props.fields,this.props.makeHistoryEntry):t.navigateByURL(this.props.routeURL,this.props.makeHistoryEntry))}}t.Link=n},function(e,s){e.exports=t},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createTree=void 0;const r=s(13);t.createTree=function(){return new r.Tree}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tree=void 0;const r=s(0),i=s(4),o=s(14),a=s(5);class n extends a.ComponentWithLocalStyles{constructor(){super(),this.onKeyDown=e=>{e.preventDefault(),"ArrowDown"===e.key?this.selectDown(this.m_selectedNode):"ArrowUp"===e.key?this.selectUp(this.m_selectedNode):"ArrowRight"===e.key?this.expandOrSelectDown(this.m_selectedNode):"ArrowLeft"===e.key&&this.collapseOrSelectUp(this.m_selectedNode)},this.m_selectedNode=null,this.tabIndex=0,this.container=new i.TreeNodeContainer(()=>new o.TreeNode(null,0,this)),this.elmRef=new r.Ref,this.prepareLocalStyles()}get tabIndex(){return this.m_tabIndex}set tabIndex(e){this.m_tabIndex=e,this.updateMe()}get nodes(){return this.container.nodes}addNode(e,t){let s=this.container.addNode(e,t);return this.updateMe(),s}removeNode(e){this.container.removeNode(e),this.updateMe()}removeAllNodes(){this.container.removeAllNodes(),this.updateMe()}expandAll(){this.container.expandAll()}collapseAll(){this.container.collapseAll()}get selectedNode(){return this.m_selectedNode}render(){return r.jsx("div",{ref:this.elmRef,tabindex:this.tabIndex,class:this.cssClassTree,keydown:this.onKeyDown},this.container)}selectDown(e){let t=this.findDown(e);t&&(t.select(),t.scrollIntoView(!1))}selectUp(e){let t=this.findUp(e);t&&(t.select(),t.scrollIntoView(!0))}expandOrSelectDown(e){if(e)if(e.container.nodes.length>0)if(e.m_isExpanded){let t=e.container.nodes[0];t.select(),t.scrollIntoView(!1)}else e.expand();else this.selectDown(e)}collapseOrSelectUp(e){e&&(e.m_isExpanded?e.collapse():this.selectUp(e))}findDown(e,t=!1){if(e)if(t){let t=e.m_parent?e.m_parent.container:this.container;if(e.index<t.nodes.length-1)return t.nodes[e.index+1];if(e.m_parent)return this.findDown(e.m_parent,!0)}else{if(!(e.isExpanded&&e.container.nodes.length>0))return this.findDown(e,!0);e.container.nodes[0].select()}else if(this.container.nodes.length>0)return this.container.nodes[0];return null}findUp(e){if(e){if(0!==e.index){let t=(e.m_parent?e.m_parent.container:this.container).nodes[e.index-1],s=this.findLastExpandedNode(t);return s||t}if(e.m_parent)return e.m_parent}else if(this.container.nodes.length>0)return this.container.nodes[0];return null}findLastExpandedNode(e){if(!e||0===e.container.nodes.length||!e.m_isExpanded)return null;let t=e.container.nodes[e.container.nodes.length-1],s=this.findLastExpandedNode(t);return s||t}prepareLocalStyles(){this.cssClassTree=this.decorateName("tree"),this.cssRuleTree=this.createStyleRule("tree",".tree(*)",{cursor:"default",border:[1,"solid","dodgerblue"],fontFamily:"Verdana, Geneva, Tahoma, sans-serif",fontSize:"12px",boxSizing:"border-box",maxHeight:"100%",overflow:"auto"}),this.cssClassNode=this.decorateName("tree-node"),this.cssRuleNode=this.createStyleRule("tree-node",".tree-node(*)",{display:"flex",alignItems:"center"}),this.cssClassNodeContent=this.decorateName("tree-node-content"),this.cssRuleNodeContent=this.createStyleRule("tree-node-content",".tree-node-content(*)",{marginLeft:"2px",padding:"1px"}),this.cssRuleNodeContentHover=this.createStyleRule("tree-node-content:hover",".tree-node-content(*):hover",{backgroundColor:"lightcyan"}),this.cssClassNodeContentSelected=this.decorateName("tree-node-content-selected"),this.cssRuleNodeContentSelected=this.createStyleRule("tree-node-content-selected",".tree-node-content-selected(*)",{marginLeft:"2px",border:[1,"dotted"],backgroundColor:"dodgerblue",color:"white"}),this.cssClassNodeIcon=this.decorateName("tree-node-icon"),this.cssRuleNodeIcon=this.createStyleRule("tree-node-icon",".tree-node-icon(*)",{fontSize:"10px",width:"1em",height:"1em"}),this.cssClassSubnodes=this.decorateName("tree-subnodes"),this.cssRuleSubNodes=this.createStyleRule("tree-subnodes",".tree-subnodes(*)",{marginLeft:"16px"})}}t.Tree=n},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TreeNode=void 0;const r=s(0),i=s(4);class o extends r.Component{constructor(e,t,s=null){super(),this.nodeFactory=()=>new o(this,this.m_level+1),this.onClick=e=>{this.select()},this.onDblClick=e=>{e.preventDefault(),e.stopPropagation(),0!==this.subNodes.length&&(this.m_isExpanded?this.collapse():this.expand())},this.onExpanderClicked=e=>{this.m_isExpanded?this.collapse():this.expand()},this.m_parent=e,this.m_tree=null!==e?e.m_tree:s,this.m_level=t,this.container=new i.TreeNodeContainer(this.nodeFactory),this.m_isExpanded=!1,this.m_isSelected=!1,this.contentElmRef=new r.Ref}get tree(){return this.m_tree}get parent(){return this.m_parent}get level(){return this.m_level}get index(){return this.m_index}set index(e){this.m_index=e}get content(){return this.m_content}set content(e){this.m_content=e,this.updateMe()}get icon(){return this.m_icon}set icon(e){this.m_icon=e,this.updateMe()}get textColor(){return this.m_textColor}set textColor(e){this.m_textColor=e,this.updateMe()}get bgColor(){return this.m_bgColor}set bgColor(e){this.m_bgColor=e,this.updateMe()}get italic(){return this.m_italic}set italic(e){this.m_italic=e,this.updateMe()}get bold(){return this.m_bold}set bold(e){this.m_bold=e,this.updateMe()}get customClass(){return this.m_customClass}set customClass(e){this.m_customClass=e,this.updateMe()}get data(){return this.m_data}set data(e){this.m_data=e}get isExpanded(){return this.m_isExpanded}expand(){this.container.nodes.length>0&&!0!==this.m_isExpanded&&(this.m_isExpanded=!0,this.updateMe())}collapse(){this.container.nodes.length>0&&!1!==this.m_isExpanded&&(this.m_isExpanded=!1,this.updateMe())}select(){!0!==this.m_isSelected&&(null!=this.m_tree.m_selectedNode&&this.m_tree.m_selectedNode.unselect(),this.m_tree.m_selectedNode=this,this.m_isSelected=!0,this.updateMe())}unselect(){!1!==this.m_isSelected&&(this.m_tree.m_selectedNode=null,this.m_isSelected=!1,this.updateMe())}get subNodes(){return this.container.nodes}addNode(e,t){let s=this.container.addNode(e,t);return 1===this.container.nodes.length&&this.updateMe(),s}removeNode(e){let t=this.container.nodes.length;this.container.removeNode(e),1===t&&0===this.container.nodes.length&&(this.m_isExpanded=!1,this.updateMe())}removeAllNodes(){this.container.nodes.length>0&&(this.container.removeAllNodes(),this.m_isExpanded=!1,this.updateMe())}expandAll(){this.expand(),this.container.expandAll()}collapseAll(){this.collapse(),this.container.collapseAll()}scrollIntoView(e){if(!this.m_tree.elmRef.r||!this.contentElmRef.r)return;let t=this.m_tree.elmRef.r.getBoundingClientRect(),s=this.contentElmRef.r.getBoundingClientRect();s.bottom<=t.bottom&&s.top>=t.top||this.contentElmRef.r.scrollIntoView(e)}render(){return r.jsx(r.Fragment,null,this.renderNode(),this.renderSubNodes())}renderNode(){let e,t=0===this.container.nodes.length?"":this.m_isExpanded?"fa-caret-down":"fa-caret-right";this.m_icon&&("class"in this.m_icon?e=r.jsx("span",{class:this.m_tree.cssClassNodeIcon+" "+this.m_icon.class,click:this.onClick,dblclick:this.onDblClick}):"img"in this.m_icon&&(e=r.jsx("img",{class:this.m_tree.cssClassNodeIcon,src:this.m_icon.img,click:this.onClick,dblclick:this.onDblClick})));let s=this.m_isSelected?this.m_tree.cssClassNodeContentSelected:this.m_tree.cssClassNodeContent;this.m_customClass&&(s+=" "+this.m_customClass);let i={};return this.m_textColor&&(i.color=this.m_textColor),this.m_bgColor&&(i.backgroundColor=this.m_bgColor),this.m_italic&&(i.fontStyle="italic"),this.m_bold&&(i.fontWeight="bold"),r.jsx("div",{class:this.m_tree.cssClassNode},r.jsx("i",{class:"fa fa-fw "+t,click:this.onExpanderClicked}),e,r.jsx("span",{ref:this.contentElmRef,dragSource:!0,class:s,style:i,click:this.onClick,dblclick:this.onDblClick},this.m_content))}renderSubNodes(){return 0===this.subNodes.length?null:r.jsx("div",{class:this.m_tree.cssClassSubnodes,style:{display:this.m_isExpanded?"block":"none"}},this.container)}}t.TreeNode=o},function(e,t){e.exports=s},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VTable=void 0;const r=s(0),i=s(6),o=s(5);class a extends o.ComponentWithLocalStyles{constructor(e){super(e),this.frameRef=e=>this.frame=e,this.wallRef=e=>this.wall=e,this.tableRef=e=>this.table=e,this.avgRowHeight=0,this.avgColWidth=0,this.latestScrollTop=-1,this.latestScrollLeft=-1,this.wallHeight=25*this.props.totalRowCount,this.wallWidth=80*this.props.totalColCount,this.minRowOverscan=this.props.rowOverscan?this.props.rowOverscan[0]:3,this.optRowOverscan=this.props.rowOverscan?this.props.rowOverscan[1]:6,this.maxRowOverscan=this.props.rowOverscan?this.props.rowOverscan[2]:12,this.minColOverscan=this.props.colOverscan?this.props.colOverscan[0]:3,this.optColOverscan=this.props.colOverscan?this.props.colOverscan[1]:6,this.maxColOverscan=this.props.colOverscan?this.props.colOverscan[2]:12,this.prepareLocalStyles()}willMount(){this.rows=[];let e=this.props.totalRowCount<10?this.props.totalRowCount:10,t=this.props.totalColCount<10?this.props.totalColCount:10;for(let s=0;s<e;s++){let e=new n;for(let r=0;r<t;r++)e.addCell(this.getCellData(s,r));this.rows.push(e)}this.firstRow=0,this.lastRow=e-1,this.firstCol=0,this.lastCol=t-1,this.vAxis=new i.ScrollAxis(this.minRowOverscan,this.optRowOverscan,this.maxRowOverscan),this.hAxis=new i.ScrollAxis(this.minColOverscan,this.optColOverscan,this.maxColOverscan)}prepareLocalStyles(){this.frameID=this.decorateName("frame"),this.createStyleRule("frame","#frame(*)",{width:"100%",height:"100%",overflow:"auto"}),this.wallID=this.decorateName("wall"),this.createStyleRule("wall","#wall(*)",{position:"relative",overflow:"hidden"}),this.tableID=this.decorateName("table"),this.createStyleRule("table","#table(*)",{position:"absolute",borderCollapse:"collapse",border:[1,"solid","black"]})}render(){return this.callMeBeforeUpdate(this.measureAndUpdate),r.jsx("div",{id:this.frameID,ref:this.frameRef,scroll:this.onScroll},r.jsx("div",{id:this.wallID,ref:this.wallRef},r.jsx("table",{id:this.tableID,ref:this.tableRef},r.jsx("tbody",null,this.renderRows))))}renderRows(){return this.rows}getCellData(e,t){return this.props.getCellCallback?this.props.getCellCallback(e,t):void 0}getColHeaderCellData(e,t){return this.props.getColHeaderCellCallback?this.props.getColHeaderCellCallback(e,t):void 0}getColFooterCellData(e,t){return this.props.getColFooterCellCallback?this.props.getColFooterCellCallback(e,t):void 0}getRowHeaderCellData(e,t){return this.props.getRowHeaderCellCallback?this.props.getRowHeaderCellCallback(e,t):void 0}getRowFooterCellData(e,t){return this.props.getRowFooterCellCallback?this.props.getRowFooterCellCallback(e,t):void 0}measureAndUpdate(){if(0===this.rowCount||0===this.colCount)return;let e=this.frame.getBoundingClientRect(),t=this.wall.getBoundingClientRect(),s=this.table.getBoundingClientRect();if(this.latestScrollTop!=this.frame.scrollTop){let r=this.vAxis.measure(this.props.totalRowCount,this.firstRow,this.rowCount,this.avgRowHeight,e.height,t.height,s.height,this.frame.scrollTop);this.avgRowHeight=r.newAvgItemSize,this.latestScrollTop=this.frame.scrollTop,r.noAddRemoveNeeded||this.updateRows(r),r.newWallSize==t.height&&r.newSubsetOffset==s.top-t.top||this.callMeAfterUpdate(()=>{this.table.style.top=r.newSubsetOffset+"px",this.wall.style.height=r.newWallSize+"px"})}if(this.latestScrollLeft!=this.frame.scrollLeft){let r=this.hAxis.measure(this.props.totalColCount,this.firstCol,this.colCount,this.avgColWidth,e.width,t.width,s.width,this.frame.scrollLeft);this.avgColWidth=r.newAvgItemSize,this.latestScrollLeft=this.frame.scrollLeft,r.noAddRemoveNeeded||this.updateCols(r),r.newWallSize==t.width&&r.newSubsetOffset==s.left-t.left||this.callMeAfterUpdate(()=>{this.table.style.left=r.newSubsetOffset+"px",this.wall.style.width=r.newWallSize+"px"})}}updateRows(e){if(e.neeedToRemoveAllItems){this.rows=[];for(let t=e.newFirst;t<=e.newLast;t++){let e=new n;for(let s=this.firstCol;s<=this.lastCol;s++)e.addCell(this.getCellData(t,s));this.rows.push(e)}}else{if(e.countToRemoveAtEnd>0&&this.rows.splice(this.rowCount-e.countToRemoveAtEnd,e.countToRemoveAtEnd),e.countToRemoveAtStart>0&&this.rows.splice(0,e.countToRemoveAtStart),e.countToAddAtEnd>0)for(let t=this.lastRow+1;t<=e.newLast;t++){let e=new n;for(let s=this.firstCol;s<=this.lastCol;s++)e.addCell(this.getCellData(t,s));this.rows.push(e)}if(e.countToAddAtStart>0)for(let t=this.firstRow-1;t>=e.newFirst;t--){let e=new n;for(let s=this.firstCol;s<=this.lastCol;s++)e.addCell(this.getCellData(t,s));this.rows.splice(0,0,e)}}this.firstRow=e.newFirst,this.lastRow=e.newLast,this.updateMe(this.renderRows)}updateCols(e){if(e.neeedToRemoveAllItems)for(let t=this.firstRow;t<=this.lastRow;t++){let s=this.rows[t-this.firstRow];s.removeAllCells();for(let r=e.newFirst;r<=e.newLast;r++)s.addCell(this.getCellData(t,r))}else{if(e.countToRemoveAtEnd>0)for(let t of this.rows)t.removeCellsAtEnd(e.countToRemoveAtEnd);if(e.countToRemoveAtStart>0)for(let t of this.rows)t.removeCellsAtStart(e.countToRemoveAtStart);if(e.countToAddAtEnd>0)for(let t=this.firstRow;t<=this.lastRow;t++){let s=this.rows[t-this.firstRow];for(let r=this.lastCol+1;r<=e.newLast;r++)s.addCell(this.getCellData(t,r))}if(e.countToAddAtStart>0)for(let t=this.firstRow;t<=this.lastRow;t++){let s=this.rows[t-this.firstRow];for(let r=this.firstCol-1;r>=e.newFirst;r--)s.insertCell(this.getCellData(t,r))}}this.firstCol=e.newFirst,this.lastCol=e.newLast}onScroll(e){this.callMeBeforeUpdate(this.measureAndUpdate)}get rowCount(){return this.lastRow-this.firstRow+1}get colCount(){return this.lastCol-this.firstCol+1}get Rows(){return`${this.firstRow} - ${this.lastRow}`}get Cols(){return`${this.firstCol} - ${this.lastCol}`}}t.VTable=a;class n extends r.Component{constructor(){super(),this.cells=[]}addCell(e){this.cells.push(new l(e)),this.updateMe()}insertCell(e){this.cells.splice(0,0,new l(e)),this.updateMe()}removeAllCells(){this.cells=[],this.updateMe()}removeCellsAtStart(e){this.cells.splice(0,e),this.updateMe()}removeCellsAtEnd(e){this.cells.splice(this.cells.length-e,e),this.updateMe()}render(){return r.jsx("tr",null,this.cells)}}class l extends r.Component{constructor(e){super(),void 0===e?this.data=void 0:"object"==typeof e&&e.content?this.data=e:this.data={content:e}}render(){return void 0===this.data?void 0:r.jsx("td",{class:this.data.class,style:this.data.style,rowspan:this.data.rowSpan?this.data.rowSpan:void 0,colspan:this.data.colSpan?this.data.colSpan:void 0},this.data.content)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.registerDragDropCustomAttributes=void 0;const r=s(0),i=s(18),o=s(19);class a{constructor(e,t){this.elmVN=e,this.currVal=t,this.add(t)}terminate(e){this.remove(),this.elmVN=void 0}update(e){return this.currVal!==e&&(this.currVal&&this.remove(),e&&this.add(e),this.currVal=e,!0)}add(e){let t=this.elmVN.elm;this.dragSourceHandler="ownerSVGElement"in t?new i.DragSourceEmulator(t,e):new i.DragSourceHandler(t,e),this.dragSourceHandler.init()}remove(){this.dragSourceHandler&&(this.dragSourceHandler.term(),this.dragSourceHandler=void 0)}}class n{constructor(e,t){this.elmVN=e,this.currVal=t,this.add(t)}terminate(e){this.remove(),this.elmVN=void 0}update(e){return this.currVal!==e&&(this.currVal&&this.remove(),e&&this.add(e),this.currVal=e,!0)}add(e){let t=this.elmVN.elm;this.dragTargetHandler=new o.DragTargetHandler(t,e),this.dragTargetHandler.init()}remove(){this.dragTargetHandler&&(this.dragTargetHandler.term(),this.dragTargetHandler=void 0)}}t.registerDragDropCustomAttributes=function(){r.registerCustomAttribute("dragSource",a),r.registerCustomAttribute("dragTarget",n)}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DragSourceEmulator=t.DragSourceHandler=void 0;const r=s(0),i=s(1),o=s(7);class a{get dragEvent(){return this.m_dragEvent}set dragEvent(e){this.m_dragEvent=e}setData(e,t){"string"==typeof t?this.m_dragEvent.dataTransfer.setData(e,t):(this.m_dragEvent.dataTransfer.setData(e,""),o.DragAndDropData.setObjectData(e,t))}}class n{constructor(e,t){this.onDragStart=e=>{if(o.DragAndDropData.clearAllObjectData(),this.dragSourceEvent.dragEvent=e,2===this.behavior){for(let e in this.simpleDragSource.data)this.dragSourceEvent.setData(e,this.simpleDragSource.data[e]);void 0!==this.simpleDragSource.allowedEffects?e.dataTransfer.effectAllowed=this.simpleDragSource.allowedEffects:e.dataTransfer.effectAllowed="all"}else if(1===this.behavior)try{this.dragSource.onDragStart&&this.dragSource.onDragStart(this.dragSourceEvent)}catch(e){throw o.DragAndDropData.clearAllObjectData(),e}else this.dragSourceEvent.setData(i.DNDTYPE_ELEMENT,this.elm),e.dataTransfer.effectAllowed="all",3===this.behavior?this.dragSourceEvent.setData("text/plain",this.elm.textContent):4===this.behavior&&this.dragSourceEvent.setData("text/plain",this.elm.outerHTML)},this.onDragEnd=e=>{if(1===this.behavior)try{this.dragSource.onDragEnd&&(this.dragSourceEvent.dragEvent=e,this.dragSource.onDragEnd(this.dragSourceEvent))}finally{o.DragAndDropData.clearAllObjectData()}else o.DragAndDropData.clearAllObjectData()},this.onDrag=e=>{1===this.behavior&&this.dragSource.onDrag&&(this.dragSourceEvent.dragEvent=e,this.dragSource.onDrag(this.dragSourceEvent))},this.elm=e,"elm-text"===t?this.behavior=3:"elm-html"===t||!0===t?this.behavior=4:void 0!==t.data?(this.behavior=2,this.simpleDragSource=t):void 0!==t.onDragStart&&(this.behavior=1,this.dragSource=t)}init(){this.dragSourceEvent=new a,this.elm.setAttribute("draggable","true"),this.elm.addEventListener("dragstart",this.onDragStart),this.elm.addEventListener("dragend",this.onDragEnd),this.elm.addEventListener("drag",this.onDrag)}term(){this.elm.removeEventListener("dragstart",this.onDragStart),this.elm.removeEventListener("dragend",this.onDragEnd),this.elm.removeEventListener("drag",this.onDrag),this.elm.removeAttribute("draggable"),this.dragSourceEvent=void 0}}t.DragSourceHandler=n;t.DragSourceEmulator=class extends n{constructor(e,t){super(e,t),this.onMouseDown=e=>{0===e.button&&(e.preventDefault(),this.mouseDownX=e.clientX,this.mouseDownY=e.clientY,document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp))},this.onMouseMove=e=>{if(0!=(1&e.buttons))if(e.preventDefault(),void 0!==this.emulDataTransfer)this.handleDragStep(e);else{let t=e.clientX-this.mouseDownX,s=e.clientY-this.mouseDownY;if(t>=-2&&t<=2&&s>=-2&&s<=2)return;this.initiateDragOperation(e)}},this.onMouseUp=e=>{void 0!==this.emulDataTransfer&&this.handleDrop(e),this.cleanupDragOperation()},this.onKeyDown=e=>{e.preventDefault(),e.stopPropagation(),27===e.keyCode?(void 0!==this.emulDataTransfer&&this.cancelDragOperation(e),this.cleanupDragOperation()):void 0!==this.emulDataTransfer&&this.handleKeyEvent(e)},this.onKeyUp=e=>{e.preventDefault(),e.stopPropagation(),void 0!==this.emulDataTransfer&&this.handleKeyEvent(e)}}init(){super.init(),this.elm.addEventListener("mousedown",this.onMouseDown)}term(){super.term(),this.elm.removeEventListener("mousedown",this.onMouseDown)}initiateDragOperation(e){"setDragImage"in DataTransfer.prototype?this.emulDataTransfer=new o.EmulDataTransfer:this.emulDataTransfer=new o.EmulLegacyDataTransfer;let t=this.createDragEventFromMouseEvent(e,"dragstart");if(this.elm.dispatchEvent(t),t.defaultPrevented)this.cleanupDragOperation();else{if(!this.emulDataTransfer.isImageElmReset){let t=this.elm.getBoundingClientRect();this.emulDataTransfer.setDragImage(this.elm,e.clientX-t.left,e.clientY-t.top)}this.lastTarget=void 0,this.isLastTargetDroppable=!1,this.isDropPossibleOnLastTarget=!1,this.handleDragStep(e)}}handleDragStep(e){this.emulDataTransfer.isImageElmReset&&(this.prepareImageElement(),this.emulDataTransfer.isImageElmReset=!1),this.emulDataTransfer.dropEffect="none",this.imageElm&&(this.imageElm.hidden=!0);let t=document.elementFromPoint(e.clientX,e.clientY);if(this.imageElm&&(this.imageElm.hidden=!1),t)if(t===this.lastTarget){if(this.isLastTargetDroppable){let s=this.createDragEventFromMouseEvent(e,"dragover");t.dispatchEvent(s),this.isDropPossibleOnLastTarget=s.defaultPrevented}}else{let s=this.createDragEventFromMouseEvent(e,"dragenter");t.dispatchEvent(s);let r=s.defaultPrevented;if(this.lastTarget&&this.isLastTargetDroppable&&this.lastTarget.dispatchEvent(this.createDragEventFromMouseEvent(e,"dragleave")),this.lastTarget=t,this.isLastTargetDroppable=r,this.isDropPossibleOnLastTarget=r,this.isLastTargetDroppable){let s=this.createDragEventFromMouseEvent(e,"dragover");t.dispatchEvent(s),this.isDropPossibleOnLastTarget=s.defaultPrevented}}else this.lastTarget&&(this.isLastTargetDroppable&&this.lastTarget.dispatchEvent(this.createDragEventFromMouseEvent(e,"dragleave")),this.lastTarget=void 0,this.isLastTargetDroppable=!1,this.isDropPossibleOnLastTarget=!1);if(this.elm.dispatchEvent(this.createDragEventFromMouseEvent(e,"drag")),this.imageElm&&(this.imageElm.style.left=e.clientX-this.emulDataTransfer.imageElmX+"px",this.imageElm.style.top=e.clientY-this.emulDataTransfer.imageElmY+"px"),this.dropEffectElm){let e=this.isDropPossibleOnLastTarget?this.emulDataTransfer.dropEffect:"none";this.setDropEffectImageCue(e),this.dropEffectElm.style.left=this.emulDataTransfer.imageElmX+12+"px",this.dropEffectElm.style.top=this.emulDataTransfer.imageElmY+0+"px"}this.lastMouseEvent=e}handleKeyEvent(e){if(this.lastTarget&&this.isLastTargetDroppable){let t=this.createDragEventFromKeyboardEvent(e,"dragover");if(this.lastTarget.dispatchEvent(t),this.isDropPossibleOnLastTarget=t.defaultPrevented,this.elm.dispatchEvent(this.createDragEventFromKeyboardEvent(e,"drag")),this.dropEffectElm){let e=this.isDropPossibleOnLastTarget?this.emulDataTransfer.dropEffect:"none";this.setDropEffectImageCue(e)}}}prepareImageElement(){this.imageElm&&(this.imageElm.remove(),this.imageElm);let e=this.emulDataTransfer.imageElm;if(!e)return;let t=document.createElement("div"),s=e.cloneNode();if(r.isSvg(e)&&!r.isSvgSvg(e)){let e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.appendChild(s),t.appendChild(e)}else t.appendChild(s);t.style.opacity="0.7",t.style.position="absolute",this.dropEffectElm=document.createElement("span"),this.dropEffectElm.style.position="absolute",t.appendChild(this.dropEffectElm),document.body.appendChild(t),this.imageElm=t;let i=s.getBoundingClientRect(),o=t.getBoundingClientRect();i.left!=o.left&&(this.emulDataTransfer.imageElmX+=i.left-o.left),i.top!=o.top&&(this.emulDataTransfer.imageElmY+=i.top-o.top)}setDropEffectImageCue(e){let t,s;switch(e){case"none":t="fa fa-fw fa-ban",s="red";break;case"copy":t="fa fa-fw fa-plus",s="green";break;case"link":t="fa fa-fw fa-link",s="blue";break;default:t="",s="black"}this.dropEffectElm.className=t,this.dropEffectElm.style.color=s}handleDrop(e){this.lastTarget?this.isDropPossibleOnLastTarget?this.lastTarget.dispatchEvent(this.createDragEventFromMouseEvent(e,"drop")):this.isLastTargetDroppable?this.lastTarget.dispatchEvent(this.createDragEventFromMouseEvent(e,"dragleave")):this.emulDataTransfer.dropEffect="none":this.emulDataTransfer.dropEffect="none",this.elm.dispatchEvent(this.createDragEventFromMouseEvent(e,"dragend"))}cancelDragOperation(e){this.emulDataTransfer.dropEffect="none",this.lastTarget&&this.isLastTargetDroppable&&this.lastTarget.dispatchEvent(this.createDragEventFromKeyboardEvent(e,"dragleave")),this.elm.dispatchEvent(this.createDragEventFromKeyboardEvent(e,"dragend"))}cleanupDragOperation(){this.emulDataTransfer=void 0,document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),this.lastTarget=void 0,this.isLastTargetDroppable=!1,this.isDropPossibleOnLastTarget=!1,this.lastMouseEvent=void 0,this.imageElm&&(this.imageElm.remove(),this.imageElm=void 0)}createDragEventFromMouseEvent(e,t){if("initDragEvent"in DragEvent.prototype){let s=document.createEvent("DragEvent");return s.initDragEvent(t,e.bubbles,e.cancelable,e.view,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget,this.emulDataTransfer),s}return new DragEvent(t,{bubbles:e.bubbles,cancelable:e.cancelable,detail:e.detail,view:e.view,altKey:e.altKey,button:e.button,buttons:e.buttons,clientX:e.clientX,clientY:e.clientY,ctrlKey:e.ctrlKey,metaKey:e.metaKey,relatedTarget:e.relatedTarget,screenX:e.screenX,screenY:e.screenY,shiftKey:e.shiftKey,dataTransfer:this.emulDataTransfer})}createDragEventFromKeyboardEvent(e,t){if("initDragEvent"in DragEvent.prototype){let s=document.createEvent("DragEvent");return s.initDragEvent(t,e.bubbles,e.cancelable,e.view,e.detail,this.lastMouseEvent.screenX,this.lastMouseEvent.screenY,this.lastMouseEvent.clientX,this.lastMouseEvent.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,this.lastMouseEvent.button,this.lastMouseEvent.relatedTarget,this.emulDataTransfer),s}return new DragEvent(t,{bubbles:e.bubbles,cancelable:e.cancelable,detail:e.detail,view:e.view,altKey:e.altKey,button:this.lastMouseEvent.button,buttons:this.lastMouseEvent.buttons,clientX:this.lastMouseEvent.clientX,clientY:this.lastMouseEvent.clientY,ctrlKey:e.ctrlKey,metaKey:e.metaKey,relatedTarget:this.lastMouseEvent.relatedTarget,screenX:this.lastMouseEvent.screenX,screenY:this.lastMouseEvent.screenY,shiftKey:e.shiftKey,dataTransfer:this.emulDataTransfer})}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DragTargetHandler=void 0;const r=s(7);class i{get dragEvent(){return this.m_dragEvent}set dragEvent(e){this.m_dragEvent=e}hasType(e){return r.DragAndDropData.hasType(this.dragEvent.dataTransfer,e)}getData(e){let t=r.DragAndDropData.getObjectData(e);return void 0!==t?t:this.m_dragEvent.dataTransfer.getData(e)}hasFiles(){let e=this.m_dragEvent.dataTransfer.files;return e&&e.length>0}getFiles(){let e=this.m_dragEvent.dataTransfer.items;if(!e||0===e.length)return;let t=[];if(e)for(let s=0;s<e.length;s++)t.push(e[s].webkitGetAsEntry());return t}}t.DragTargetHandler=class{constructor(e,t){this.onDragEnter=e=>{if(e.stopPropagation(),this.dragTargetEnterCounter++>0)this.isDropPossible&&e.preventDefault();else{if(this.isDropPossible=!1,void 0!==this.simpleDragTarget){for(let t of this.simpleDragTarget.dataTypes)if(r.DragAndDropData.hasType(e.dataTransfer,t)){this.isDropPossible=!0;break}if(!this.isDropPossible)return}else void 0!==this.dragTarget&&(void 0===this.dragTarget.onDragEnter?this.isDropPossible=!0:(this.dragTargetEvent.dragEvent=e,this.isDropPossible=this.dragTarget.onDragEnter(this.dragTargetEvent)));if(this.isDropPossible)if(e.preventDefault(),void 0!==this.simpleDragTarget){if(void 0!==this.simpleDragTarget.feedback){let e=this.elm.style;this.savedStyle={};for(let t in this.simpleDragTarget.feedback)this.savedStyle[t]=e[t],e[t]=this.simpleDragTarget.feedback[t]}}else void 0!==this.dragTarget&&void 0===this.dragTarget.onDragEnter&&(e.dataTransfer.dropEffect=this.getDefaultDropEffect(e))}},this.onDragOver=e=>{e.stopPropagation();let t=!1;void 0!==this.simpleDragTarget?t=!0:void 0!==this.dragTarget&&(void 0===this.dragTarget.onDragOver?t=!0:(this.dragTargetEvent.dragEvent=e,t=this.dragTarget.onDragOver(this.dragTargetEvent))),t&&(e.preventDefault(),(void 0!==this.simpleDragTarget||void 0!==this.dragTarget&&void 0===this.dragTarget.onDragOver)&&(e.dataTransfer.dropEffect=this.getDefaultDropEffect(e)))},this.onDragLeave=e=>{if(e.preventDefault(),e.stopPropagation(),!(--this.dragTargetEnterCounter>0))if(void 0!==this.simpleDragTarget){if(void 0!==this.savedStyle){let e=this.elm.style;for(let t in this.savedStyle)e[t]=this.savedStyle[t];this.savedStyle=void 0}}else void 0!==this.dragTarget&&void 0!==this.dragTarget.onDragLeave&&(this.dragTargetEvent.dragEvent=e,this.dragTarget.onDragLeave(this.dragTargetEvent))},this.onDrop=e=>{if(e.preventDefault(),e.stopPropagation(),void 0!==this.simpleDragTarget){let t=this.simpleDragTarget.dataTypes,s={};for(let i of e.dataTransfer.types){if(t&&t.length>0&&t.indexOf(i)<0)continue;let o=r.DragAndDropData.getObjectData(i);void 0!==o?s[i]=o:(o=e.dataTransfer.getData(i),void 0!==o&&(s[i]=o))}this.simpleDragTarget.onDataDropped(s)}else void 0!==this.dragTarget&&(this.dragTargetEvent.dragEvent=e,this.dragTarget.onDrop(this.dragTargetEvent));this.dragTargetEnterCounter=0},this.elm=e,void 0!==t.onDrop?this.dragTarget=t:void 0!==t.onDataDropped&&(this.simpleDragTarget=t)}init(){this.dragTargetEvent=new i,this.dragTargetEnterCounter=0,this.elm.addEventListener("dragenter",this.onDragEnter),this.elm.addEventListener("dragleave",this.onDragLeave),this.elm.addEventListener("dragover",this.onDragOver),this.elm.addEventListener("drop",this.onDrop)}term(){this.elm.removeEventListener("dragenter",this.onDragEnter),this.elm.removeEventListener("dragleave",this.onDragLeave),this.elm.removeEventListener("dragover",this.onDragOver),this.elm.removeEventListener("drop",this.onDrop),this.dragTargetEvent=void 0}getDefaultDropEffect(e){switch(e.dataTransfer.effectAllowed){case"copy":return"copy";case"move":return"move";case"link":return"link";case"copyMove":return e.ctrlKey?"copy":"move";case"copyLink":return e.altKey?"link":"copy";case"linkMove":return e.altKey?"link":"move";case"all":return e.altKey?"link":e.ctrlKey?"copy":"move"}}isDropEffectAllowed(e,t){switch(t){case"copy":return"copy"===e;case"move":return"move"===e;case"link":return"link"===e;case"copyMove":return"copy"===e||"move"===e;case"copyLink":return"copy"===e||"link"===e;case"linkMove":return"link"===e||"move"===e;case"all":return"none"!==e;default:return!1}}}}])}));
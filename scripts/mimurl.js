!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.mimurl=t():e.mimurl=t()}(this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Protocol=0]="Protocol",e[e.Hostname=1]="Hostname",e[e.Port=2]="Port",e[e.Path=3]="Path",e[e.Query=4]="Query",e[e.Hash=5]="Hash"}(t.EUrlPart||(t.EUrlPart={})),function(e){e[e.String=0]="String",e[e.Integer=1]="Integer",e[e.Float=2]="Float",e[e.Boolean=3]="Boolean"}(t.FieldFormat||(t.FieldFormat={}));const n=r(2),s=r(3),a=r(4);t.parseURL=function(e){return n.parseURL(e)},t.parseUrlPattern=function(e){return s.parsePattern(e)},t.match=function(e,t){return a.match(e,t)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(0))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseURL=function(e){let t,r={},n=e.indexOf("://");if(0===n)return null;n>0?(r.protocol=e.substr(0,n),t=n+3):t="/"===e[0]?-1:0;let s=t<0?0:t,a=e.indexOf(":",s),i=e.indexOf("/",s),o=e.indexOf("?",s),l=e.indexOf("#",s);if(t>=0){r.hostname=a>0?e.substr(t,a-t).split("."):i>0?e.substr(t,i-t).split("."):o>0?e.substr(t,o-t).split("."):l>0?e.substr(t,l-t).split("."):e.substr(t).split(".");for(let e=0;e<r.hostname.length;e++)r.hostname[e]=decodeURIComponent(r.hostname[e])}if(a>0&&(r.port=i>0?e.substr(a+1,i-a-1):o>0?e.substr(a+1,o-a-1):l>0?e.substr(a+1,l-a-1):e.substr(a+1)),i>=0){r.path=o>0?e.substr(i+1,o-i-1).split("/"):l>0?e.substr(i+1,l-i-1).split("/"):e.substr(i+1).split("/");for(let e=0;e<r.path.length;e++)r.path[e]=decodeURIComponent(r.path[e])}if(o>0){let t;r.query={};let n=(t=l>0?e.substr(o+1,l-o-1):e.substr(o+1)).split("&");for(let e of n){let t=e.split("=");if(2===t.length){let e=decodeURIComponent(t[0]),n=decodeURIComponent(t[1]);e in r.query?r.query[e].push(n):r.query[e]=[n]}}}return l>0&&(r.hash=decodeURIComponent(e.substr(l+1))),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);let s,a,i,o;function l(){return i>=a}function u(){if(i===a)throw new S("Invalid URL pattern end")}function h(e=1){return i<=a-e?(o=s[i+=e],!0):(i=a,!1)}t.parsePattern=function(e){if(s=e,a=0,i=0,o="",!e)throw new S("URL pattern cannot be empty");a=e.length,o=e[0];let t=new f;return t.parse(),t};class f{get protocol(){return this.parts[n.EUrlPart.Protocol]}get hostname(){return this.parts[n.EUrlPart.Hostname]}get port(){return this.parts[n.EUrlPart.Port]}get path(){return this.parts[n.EUrlPart.Path]}get query(){return this.parts[n.EUrlPart.Query]}get hash(){return this.parts[n.EUrlPart.Hash]}constructor(){this.patternString=s,this.parts=[]}parse(){for(let e=this.findFirstUrlPart();null!==e&&(e.parse(),this.parts[e.urlPart]=e,!l());e=e.getNextUrlPart());}findFirstUrlPart(){if("/"===o)return a>1&&"/"===s[1]?(h(2),new w):(h(),new x);{let e=s.indexOf("://");if(e>0)return new g;if(e<0)return new w;throw new S("URL pattern cannot start from '://'")}}}class c{constructor(){this.location={start:i,length:0}}finalize(){this.location.length=i-this.location.start,this.tokenSting=s.substr(this.location.start,this.location.length)}}class p extends c{constructor(e,t){super(),this.urlPart=e,this.caseSensitive=t}}class d extends p{constructor(e,t){super(e,t)}parse(){let e=new E;e.parse(this.getSegmentEndCharacters(),!1,this.caseSensitive),this.segment=e,this.finalize()}getSegments(){return[this.segment]}}class m extends p{constructor(e,t){super(e,t),this.segments=[]}parse(){let e=this.getPartEndCharacters();for(;!l();){let t=new E;if(t.parse(this.getSegmentEndCharacters(),!0,this.caseSensitive),this.segments.push(t),e.indexOf(o)>=0)break;h()}this.finalize()}getSegments(){return this.segments}}class g extends d{constructor(){super(n.EUrlPart.Protocol,!1)}getSegmentEndCharacters(){return":"}getNextUrlPart(){if(":"===o&&i+2<a&&"/"===s[i+1]&&"/"===s[i+2]){return h(3),u(),new w}throw new S("Invalid characters after protocol part")}}class w extends m{constructor(){super(n.EUrlPart.Hostname,!1)}getSegmentEndCharacters(){return".:/?#"}getPartEndCharacters(){return":/?#"}getNextUrlPart(){if(":"===o)return h(),u(),new P;if("/"===o)return h(),u(),new x;if("?"===o)return h(),u(),new U;if("#"===o)return h(),u(),new y;throw new S(`Invalid character '${o}' after hostname segment`)}}class P extends d{constructor(){super(n.EUrlPart.Port,!1)}getSegmentEndCharacters(){return"/?#"}getNextUrlPart(){if("/"===o)return h(),u(),new x;if("?"===o)return h(),u(),new U;if("#"===o)return h(),u(),new y;throw new S(`Invalid character '${o}' after port part`)}}class x extends m{constructor(){super(n.EUrlPart.Path,!0)}getSegmentEndCharacters(){return"/?#"}getPartEndCharacters(){return"?#"}getNextUrlPart(){if("?"===o)return h(),u(),new U;if("#"===o)return h(),u(),new y;throw new S(`Invalid character '${o}' after path segment`)}}class U extends p{constructor(){super(n.EUrlPart.Query,!0),this.parsedQSPs={},this.allowExtraQueryParams=!0}parse(){for(;!l()&&"#"!==o;)if("!"===o)this.allowExtraQueryParams=!1,h();else{let e=new b;if(e.parse(),e.name in this.parsedQSPs)throw new S(`Query string parameter '${e.name}' appears more than once`);this.parsedQSPs[e.name]=e,"&"===o&&h()}this.finalize()}getNextUrlPart(){if("#"===o)return h(),u(),new y;throw new S(`Invalid character '${o}' after query string segment`)}getSegments(){let e=[];for(let t in this.parsedQSPs)e.push(this.parsedQSPs[t].segment);return e}}class y extends d{constructor(){super(n.EUrlPart.Hash,!0)}getSegmentEndCharacters(){return""}getNextUrlPart(){return null}}class b extends c{constructor(){super(),this.name=""}parse(){for(;!l()&&"=&#".indexOf(o)<0;)this.name+=o,h();if(u(),!this.name)throw new S("Query string parameter doesn't have name");if("="!==o)throw new S("Query string parameter doesn't have value");h(),u();let e=new E;e.parse("&#",!0,!0),this.segment=e,this.finalize()}isNameEndCharacter(e){return"=&#".indexOf(e)>=0}}class E extends c{constructor(){super(),this.isOptional=!1,this.isMulti=!1,this.fields=[]}parse(e,t,r){this.analizeFirstChar(e,t)&&h();let n=[];for(;!l()&&e.indexOf(o)<0;){let t;if("{"===o){let r=new O;r.parse(e),t=r}else if("("===o){let e=new v;e.parse(),t=e}else{let r=new F;r.parse(e+"{("),t=r}n.push(t)}this.generateRegExp(n,r),this.finalize()}analizeFirstChar(e,t){switch(o){case"?":return this.isOptional=!0,!0;case"!":return!0;case"*":if(!t)throw new S("Single-segment URL part cannot start from '*'");return this.isOptional=this.isMulti=!0,!0;case"+":if(!t)throw new S("Single-segment URL part cannot start from '+'");return this.isMulti=!0,!0;default:if(e.indexOf(o)>=0)throw new S("Empty segment encountered");return!1}}generateRegExp(e,t){let r=1,n="";if(0===e.length)n+=".+";else for(let t of e)t instanceof F?n+=t.content:t instanceof v?(n+="("+t.content+")",r+=1+t.capturingGroupQty):(t.isArray=this.isMulti,t.index=r,this.fields.push(t),n+=this.generateRegExpSectionForField(t),r++,t.matchPattern&&(r+=1+t.matchPattern.capturingGroupQty));this.regExp=new RegExp(n,t?"":"i")}generateRegExpSectionForField(e){let t="";return e.matchPattern&&e.matchPattern.content?(t+=e.matchPattern.content,e.isOptional&&(t+="?")):e.isOptional?t+="(.*)":t+="(.+)",t}}class F extends c{constructor(){super(),this.content=""}parse(e){let t="";for(;!l()&&e.indexOf(o)<0;)t+=o,h();this.content=decodeURIComponent(t),this.finalize()}}class v extends c{constructor(){super(),this.content="",this.capturingGroupQty=0}parse(){let e=[];for(;!l();){let t=o;if(")"===t){if("("!==e.pop())throw new S(`Non-matching character '${t}' in regular expression`);if(h(),0===e.length)return this.content+=t,void this.finalize()}else if("}"===t){if("{"!==e.pop())throw new S(`Non-matching character '${t}' in regular expression`);h()}else if("]"===t){if("["!==e.pop())throw new S(`Non-matching character '${t}' in regular expression`);h()}else"({[".indexOf(t)>=0?("("===t&&this.capturingGroupQty++,e.push(t),h()):"\\"===t?(this.content+=t,h(),u(),t=o,h()):h();this.content+=t}throw new S("Invalid URL pattern end within regular expression")}finalize(){if(!this.content)throw new S("Empty regular expression");super.finalize()}}class O extends c{constructor(){super(),this.isOptional=!1,this.name="",this.format=n.FieldFormat.String,this.matchPattern=null}parse(e){for(h(),u(),"?"===o&&(this.isOptional=!0,h());!l();){if(e.indexOf(o)>=0)throw new S("Field doesn't have closing '}'");if("}(%=".indexOf(o)>=0)break;this.name+=o,h()}if(0===this.name.length)throw new S("Field must have name");if(u(),"%"===o){h(),u();let e=o;if("i"===e)this.format=n.FieldFormat.Integer,h();else if("f"===e)this.format=n.FieldFormat.Float,h();else{if("b"!==e)throw new S(`Invalid character '${o}' within field format`);this.format=n.FieldFormat.Boolean,h()}u()}if("("===o){let e=new v;e.parse(),this.matchPattern=e,u()}if("="===o)this.isOptional=!0,h(),this.parseDefaultValue(e);else switch(this.format){case n.FieldFormat.Integer:case n.FieldFormat.Float:this.defaultValue=NaN;break;case n.FieldFormat.Boolean:this.defaultValue=void 0;break;default:this.defaultValue=""}if("}"!==o)throw new S(`Invalid character '${o}' within field`);this.finalize(),h()}parseDefaultValue(e){let t="";for(;!l();){if(e.indexOf(o)>=0)throw new S("Field doesn't have closing '}'");if("}"===o)break;t+=o,h()}if(!t)throw new S("Field default value cannot be empty");if(t=decodeURIComponent(t),this.format===n.FieldFormat.Integer){if(this.defaultValue=Number(t),isNaN(this.defaultValue)||!Number.isInteger(this.defaultValue))throw new S(`Default value '${t}' of Integer field '${this.name}' cannot be converted to Integer`)}else if(this.format===n.FieldFormat.Float){if(this.defaultValue=Number(t),isNaN(this.defaultValue))throw new S(`Default value of '${t}' Float field '${this.name}' cannot be converted to Float`)}else if(this.format===n.FieldFormat.Boolean){let e=t.toLowerCase();if("true"===e||"t"===e||"yes"===e||"y"===e||"1"===e)this.defaultValue=!0;else{if("false"!==e&&"f"!==e&&"no"!==e&&"n"!==e&&"0"!==e)throw new S(`Default value of '${t}' Boolean field '${this.name}' cannot be converted to Boolean`);this.defaultValue=!1}}else this.defaultValue=t}}class S extends Error{constructor(e){super(),this.pos=i,this.message=`Error at position ${this.pos}: ${e}`}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);function s(e,t){if(!e)throw new Error("URL cannot be null");if(!t)throw new Error("parsedPattern cannot be null");let r=new f;r.parsedURL=e,r.fields={};let s=[];try{let l=a(n.EUrlPart.Protocol,e.protocol,t.protocol?t.protocol.segment:null,r.fields);l&&s.push(l),(l=o(n.EUrlPart.Hostname,e.hostname,t.hostname?t.hostname.segments:null,r.fields))&&s.push(l),(l=a(n.EUrlPart.Port,e.port,t.port?t.port.segment:null,r.fields))&&s.push(l),(l=o(n.EUrlPart.Path,e.path,t.path?t.path.segments:null,r.fields))&&s.push(l),(l=function(e,t,r){if(!t)return null;if(!e)return 0===Object.keys(t.parsedQSPs).length?null:"URL doesn't have query string parameters specified in the pattern";for(let r in t.parsedQSPs)if(void 0===e[r])return`URL doesn't have query string parameter '${r}'`;for(let n in e){let s=t.parsedQSPs[n].segment;if(s){let t=e[n];if(!s.isMulti&&t.length>1)return`URL has multiple values for query string parameter '${n}' while pattern doesn't specify it as multi`;for(let e of t)if(!i(e,s,r))return`URL's query string parameter '${n}' doesn't match that specified in the pattern`}else if(!t.allowExtraQueryParams)return`URL has query string parameter '${n}' that is not specified in the pattern`}return null}(e.query,t.query,r.fields))&&s.push(l),(l=a(n.EUrlPart.Hash,e.hash,t.hash?t.hash.segment:null,r.fields))&&s.push(l)}catch(e){s.push(e.message)}return s.length>0&&(r.errors=s),r}function a(e,t,r,s){return r?t?i(t,r,s)?null:`URL segment '${t}' in part '${n.EUrlPart[e]}' doesn't match `+`pattern segment '${r.tokenSting}'`:r.isOptional?null:`URL part '${n.EUrlPart[e]}' doesn't have a segment corresponding `+`to a mandatory pattern segment '${r.tokenSting}'`:t?`URL part '${n.EUrlPart[e]}' contains segment '${t}' that doesn't exist in the pattern`:null}function i(e,t,r){let n=t.regExp.exec(e);if(!n||n[0]!==e)return!1;for(let e of t.fields){if(e.index>=n.length)return console.error("BUG: Field index not found in patter's regular expression execution result"),!1;let t=u(e,n[e.index]);if(e.isArray){let n=r[e.name];void 0===n&&(n=[],r[e.name]=n),n.push(t)}else r[e.name]=t}return!0}function o(e,t,r,s){if(!t&&!r)return null;if(!t)return`URL doesn't have part '${n.EUrlPart[e]}' that exists in the pattern`;if(!r)return`URL has part '${n.EUrlPart[e]}' that doesn't exist in the pattern`;let a=[];for(let e of r)e.isMulti&&!e.isOptional?(a.push(new h(e,!1)),a.push(new h(e,!0))):a.push(new h(e,e.isOptional));return function e(t,r,n,s,a){let o=r;let u=s;for(;u<n.length&&o<t.length;){let r=n[u],s=t[o];if(r.isOptional){let h={};if(e(t,o,n,u+1,h))return l(a,h),!0;if(!i(s,r.parsedSegment,h))return!1;l(a,h),o++,r.parsedSegment.isMulti||u++}else{if(!i(s,r.parsedSegment,a))return!1;u++,o++}}if(u===n.length&&o===t.length)return!0;if(u===n.length)return!1;for(let e=u;e<n.length;e++){let t=n[e];if(!t.isOptional)return!1}return!0}(t,0,a,0,s)?null:`URL part '${n.EUrlPart[e]}' doesn't match the pattern`}function l(e,t){for(let r in t){let n=t[r],s=e[r];if(void 0===s)e[r]=n;else{let e=n,t=s;for(let r of e)t.push(r)}}}function u(e,t){if(!t)return e.defaultValue;switch(e.format){case n.FieldFormat.Integer:{let r=Number(t);return isNaN(r)||!Number.isInteger(r)?e.defaultValue:r}case n.FieldFormat.Float:{let r=Number(t);return isNaN(r)?e.defaultValue:r}case n.FieldFormat.Boolean:{let r=t.toLowerCase();return"true"===r||"t"===r||"yes"===r||"y"===r||"1"===r||"false"!==r&&"f"!==r&&"no"!==r&&"n"!==r&&"0"!==r&&e.defaultValue}default:return t}}t.match=function(e,t){if(!e)throw new Error("URL cannot be null or empty string");if(!t)throw new Error("Pattern cannot be null or empty string");return s("string"==typeof e?n.parseURL(e):e,"string"==typeof t?n.parseUrlPattern(t):t)},t.matchParsed=s;class h{constructor(e,t){this.parsedSegment=e,this.isOptional=t}}class f{get success(){return!this.errors||0===this.errors.length}}}])});
//# sourceMappingURL=mimurl.js.map